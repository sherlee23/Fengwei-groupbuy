<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>锋味派美食团购</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #FF4757;
            --secondary: #FF6B81;
        }
        body {
            font-family: 'PingFang SC', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
            background: #f5f5f5;
        }
        .header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border-radius: 0 0 15px 15px;
            margin-bottom: 20px;
        }
        .product {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
        }
        .quantity-btn {
            width: 30px;
            height: 30px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 16px;
        }
        .quantity-input {
            width: 40px;
            text-align: center;
            margin: 0 8px;
        }
        .submit-btn {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 16px;
        }
        .category-title {
            font-size: 18px;
            margin: 20px 0 10px;
            color: #333;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🍢 锋味派美食团购</h1>
    </div>

    <form id="orderForm">
        <!-- 客户信息 -->
        <div style="background: white; padding: 12px; border-radius: 10px; margin-bottom: 15px;">
            <div style="margin-bottom: 12px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">👤 姓名</label>
                <input type="text" id="name" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
            </div>
            <div style="margin-bottom: 12px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">📱 电话</label>
                <input type="tel" id="phone" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
            </div>
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">🚚 取货方式</label>
                <select id="delivery" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                    <option value="">请选择...</option>
                    <option value="self-pickup">自取</option>
                    <option value="lalamove">Lalamove送货</option>
                </select>
            </div>
        </div>

        <!-- 商品列表 -->
        <h2 class="category-title">🛒 请选择商品</h2>

<!-- 烤肠系列 -->
        <h3 class="category-title">🌭 烤肠系列</h3>
        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">原味烤肠</span>
                <span style="color: var(--primary); font-weight: bold;">RM28</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="原味烤肠">-</button>
                <input type="number" class="quantity-input" id="原味烤肠" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="原味烤肠">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">烟熏蜜汁烤肠</span>
                <span style="color: var(--primary); font-weight: bold;">RM28</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="烟熏蜜汁烤肠">-</button>
                <input type="number" class="quantity-input" id="烟熏蜜汁烤肠" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="烟熏蜜汁烤肠">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">法式香草烤肠</span>
                <span style="color: var(--primary); font-weight: bold;">RM28</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="法式香草烤肠">-</button>
                <input type="number" class="quantity-input" id="法式香草烤肠" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="法式香草烤肠">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">黑胡椒烤肠</span>
                <span style="color: var(--primary); font-weight: bold;">RM28</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="黑胡椒烤肠">-</button>
                <input type="number" class="quantity-input" id="黑胡椒烤肠" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="黑胡椒烤肠">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">孜然脆骨烤肠</span>
                <span style="color: var(--primary); font-weight: bold;">RM28</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="孜然脆骨烤肠">-</button>
                <input type="number" class="quantity-input" id="孜然脆骨烤肠" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="孜然脆骨烤肠">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">芝士玉米烤肠</span>
                <span style="color: var(--primary); font-weight: bold;">RM28</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="芝士玉米烤肠">-</button>
                <input type="number" class="quantity-input" id="芝士玉米烤肠" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="芝士玉米烤肠">+</button>
            </div>
        </div>

        <!-- 虾肠&虾饼系列 -->
        <h3 class="category-title">🦐 虾肠&虾饼系列</h3>
        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">原味虾肠</span>
                <span style="color: var(--primary); font-weight: bold;">RM33</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="原味虾肠">-</button>
                <input type="number" class="quantity-input" id="原味虾肠" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="原味虾肠">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">辣味虾肠</span>
                <span style="color: var(--primary); font-weight: bold;">RM33</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="辣味虾肠">-</button>
                <input type="number" class="quantity-input" id="辣味虾肠" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="辣味虾肠">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">虾饼</span>
                <span style="color: var(--primary); font-weight: bold;">RM28</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="虾饼">-</button>
                <input type="number" class="quantity-input" id="虾饼" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="虾饼">+</button>
            </div>
        </div>

        <!-- 披萨系列 -->
        <h3 class="category-title">🍕 披萨系列</h3>
        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">玛格丽特披萨</span>
                <span style="color: var(--primary); font-weight: bold;">RM25</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="玛格丽特披萨">-</button>
                <input type="number" class="quantity-input" id="玛格丽特披萨" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="玛格丽特披萨">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">黑椒牛肉披萨</span>
                <span style="color: var(--primary); font-weight: bold;">RM25</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="黑椒牛肉披萨">-</button>
                <input type="number" class="quantity-input" id="黑椒牛肉披萨" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="黑椒牛肉披萨">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">奥尔良鸡肉披萨</span>
                <span style="color: var(--primary); font-weight: bold;">RM25</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="奥尔良鸡肉披萨">-</button>
                <input type="number" class="quantity-input" id="奥尔良鸡肉披萨" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="奥尔良鸡肉披萨">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">双料榴莲披萨</span>
                <span style="color: var(--primary); font-weight: bold;">RM40</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="双料榴莲披萨">-</button>
                <input type="number" class="quantity-input" id="双料榴莲披萨" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="双料榴莲披萨">+</button>
            </div>
        </div>

        <!-- 酥饼系列 -->
        <h3 class="category-title">🥮 酥饼系列</h3>
        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">黑猪肉酥饼</span>
                <span style="color: var(--primary); font-weight: bold;">RM55</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="黑猪肉酥饼">-</button>
                <input type="number" class="quantity-input" id="黑猪肉酥饼" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="黑猪肉酥饼">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">安格斯牛肉酥饼</span>
                <span style="color: var(--primary); font-weight: bold;">RM55</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="安格斯牛肉酥饼">-</button>
                <input type="number" class="quantity-input" id="安格斯牛肉酥饼" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="安格斯牛肉酥饼">+</button>
            </div>
        </div>

        <!-- 小笼汤包系列 -->
        <h3 class="category-title">🥟 小笼汤包系列</h3>
        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">鲜肉小笼汤包</span>
                <span style="color: var(--primary); font-weight: bold;">RM12</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="鲜肉小笼汤包">-</button>
                <input type="number" class="quantity-input" id="鲜肉小笼汤包" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="鲜肉小笼汤包">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">菌菇小笼汤包</span>
                <span style="color: var(--primary); font-weight: bold;">RM12</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="菌菇小笼汤包">-</button>
                <input type="number" class="quantity-input" id="菌菇小笼汤包" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="菌菇小笼汤包">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">黑松露小笼汤包</span>
                <span style="color: var(--primary); font-weight: bold;">RM12</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="黑松露小笼汤包">-</button>
                <input type="number" class="quantity-input" id="黑松露小笼汤包" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="黑松露小笼汤包">+</button>
            </div>
        </div>

        <!-- 鸡排系列 -->
        <h3 class="category-title">🍗 鸡排系列</h3>
        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">原味鸡排</span>
                <span style="color: var(--primary); font-weight: bold;">RM20</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="原味鸡排">-</button>
                <input type="number" class="quantity-input" id="原味鸡排" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="原味鸡排">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">奥尔良鸡排</span>
                <span style="color: var(--primary); font-weight: bold;">RM20</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="奥尔良鸡排">-</button>
                <input type="number" class="quantity-input" id="奥尔良鸡排" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="奥尔良鸡排">+</button>
            </div>
        </div>

        <!-- 鸡翅系列 -->
        <h3 class="category-title">🍗 鸡翅系列</h3>
        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">奥尔良鸡翅</span>
                <span style="color: var(--primary); font-weight: bold;">RM25</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="奥尔良鸡翅">-</button>
                <input type="number" class="quantity-input" id="奥尔良鸡翅" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="奥尔良鸡翅">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">青花椒鸡翅</span>
                <span style="color: var(--primary); font-weight: bold;">RM25</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="青花椒鸡翅">-</button>
                <input type="number" class="quantity-input" id="青花椒鸡翅" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="青花椒鸡翅">+</button>
            </div>
        </div>

        <!-- 纸皮烧卖系列 -->
        <h3 class="category-title">🥟 纸皮烧卖系列</h3>
        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">黑猪三丁纸皮烧卖</span>
                <span style="color: var(--primary); font-weight: bold;">RM15</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="黑猪三丁纸皮烧卖">-</button>
                <input type="number" class="quantity-input" id="黑猪三丁纸皮烧卖" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="黑猪三丁纸皮烧卖">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">黑椒牛肉纸皮烧卖</span>
                <span style="color: var(--primary); font-weight: bold;">RM15</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="黑椒牛肉纸皮烧卖">-</button>
                <input type="number" class="quantity-input" id="黑椒牛肉纸皮烧卖" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="黑椒牛肉纸皮烧卖">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">黑猪梅菜干纸皮烧卖</span>
                <span style="color: var(--primary); font-weight: bold;">RM15</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="黑猪梅菜干纸皮烧卖">-</button>
                <input type="number" class="quantity-input" id="黑猪梅菜干纸皮烧卖" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="黑猪梅菜干纸皮烧卖">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">三丁芝士纸皮烧卖</span>
                <span style="color: var(--primary); font-weight: bold;">RM15</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="三丁芝士纸皮烧卖">-</button>
                <input type="number" class="quantity-input" id="三丁芝士纸皮烧卖" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="三丁芝士纸皮烧卖">+</button>
            </div>
        </div>

        <div class="product">
            <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: bold;">乌米腊味纸皮烧卖</span>
                <span style="color: var(--primary); font-weight: bold;">RM15</span>
            </div>
            <div class="quantity-control">
                <button type="button" class="quantity-btn minus" data-product="乌米腊味纸皮烧卖">-</button>
                <input type="number" class="quantity-input" id="乌米腊味纸皮烧卖" value="0" min="0">
                <button type="button" class="quantity-btn plus" data-product="乌米腊味纸皮烧卖">+</button>
            </div>
        </div>

<!-- 支付凭证上传 -->
        <div style="background: white; padding: 12px; border-radius: 10px; margin-top: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: bold;">💳 支付凭证（必传）</label>
            <input type="file" id="payment" accept="image/*,.pdf" required 
                   style="width: 100%; padding: 8px; border: 1px dashed #ddd; border-radius: 6px;">
            <p style="font-size: 12px; color: #666; margin-top: 5px;">请上传转账截图或PDF凭证</p>
        </div>

        <!-- 订单总额显示 -->
        <div style="background: white; padding: 12px; border-radius: 10px; margin: 15px 0; text-align: right;">
            <span style="font-weight: bold;">订单总额：</span>
            <span id="totalAmount" style="color: var(--primary); font-weight: bold; font-size: 18px;">RM0</span>
        </div>

        <!-- 提交按钮 -->
        <button type="submit" class="submit-btn">
            <span style="font-size: 18px;">🚀</span> 确认提交订单
        </button>
    </form>

<script>
        // 初始化Supabase
        const supabase = supabase.createClient(
            'https://edfnhhthztskuuosuasw.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVkZm5oaHRoenRza3V1b3N1YXN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5OTYxMTYsImV4cCI6MjA2NTU3MjExNn0.O3g2gjvsWagmWgmzoeJA8mPampvLYJr-KgqVwXsKoAo'
        );

        // 商品价格表（27个商品）
        const productPrices = {
            '原味烤肠': 28,
            '烟熏蜜汁烤肠': 28,
            '法式香草烤肠': 28,
            '黑胡椒烤肠': 28,
            '孜然脆骨烤肠': 28,
            '芝士玉米烤肠': 28,
            '原味虾肠': 33,
            '辣味虾肠': 33,
            '虾饼': 28,
            '玛格丽特披萨': 25,
            '黑椒牛肉披萨': 25,
            '奥尔良鸡肉披萨': 25,
            '双料榴莲披萨': 40,
            '黑猪肉酥饼': 55,
            '安格斯牛肉酥饼': 55,
            '鲜肉小笼汤包': 12,
            '菌菇小笼汤包': 12,
            '黑松露小笼汤包': 12,
            '原味鸡排': 20,
            '奥尔良鸡排': 20,
            '奥尔良鸡翅': 25,
            '青花椒鸡翅': 25,
            '黑猪三丁纸皮烧卖': 15,
            '黑椒牛肉纸皮烧卖': 15,
            '黑猪梅菜干纸皮烧卖': 15,
            '三丁芝士纸皮烧卖': 15,
            '乌米腊味纸皮烧卖': 15
        };

        // 数量控制
        document.addEventListener('click', function(e) {
            const btn = e.target.closest('.quantity-btn');
            if (!btn) return;
            
            const input = document.getElementById(btn.dataset.product);
            let value = parseInt(input.value) || 0;
            input.value = btn.classList.contains('plus') ? value + 1 : Math.max(0, value - 1);
        });

        // 提交订单
        document.getElementById('orderForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                // 1. 收集订单商品
                const orderItems = [];
                let total = 0;
                
                for (const [product, price] of Object.entries(productPrices)) {
                    const qty = parseInt(document.getElementById(product).value) || 0;
                    if (qty > 0) {
                        orderItems.push({ product, quantity: qty, price });
                        total += qty * price;
                    }
                }
                
                if (orderItems.length === 0) {
                    alert('请至少选择一件商品');
                    return;
                }
                
                // 2. 上传支付凭证
                const paymentFile = document.getElementById('payment').files[0];
                let paymentUrl = '';
                
                if (paymentFile) {
                    const fileExt = paymentFile.name.split('.').pop();
                    const fileName = `${Date.now()}.${fileExt}`;
                    
                    const { error: uploadError } = await supabase.storage
                        .from('payment-proofs')
                        .upload(fileName, paymentFile);
                    
                    if (uploadError) throw uploadError;
                    
                    paymentUrl = `${supabase.supabaseUrl}/storage/v1/object/public/payment-proofs/${fileName}`;
                }
                
                // 3. 提交订单
                const { error } = await supabase.from('orders').insert({
                    name: document.getElementById('name').value,
                    phone: document.getElementById('phone').value,
                    delivery_method: document.getElementById('delivery').value,
                    order_items: orderItems,
                    total_amount: total,
                    payment_proof_url: paymentUrl,
                    created_at: new Date().toISOString()
                });
                
                if (error) throw error;
                
                alert('订单提交成功！');
                document.getElementById('orderForm').reset();
                document.querySelectorAll('.quantity-input').forEach(input => input.value = 0);
                
            } catch (err) {
                console.error(err);
                alert('提交失败: ' + (err.message || '请稍后重试'));
            }
        });
    </script>
</body>
</html>