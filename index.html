<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>锋味派美食团购</title>
    <!-- 添加Excel导出库 -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #FF4757;
            --secondary: #FF6B81;
            --accent: #FFA502;
            --light: #F1F2F6;
            --dark: #2F3542;
        }
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
        }
        /* 保持原有所有样式不变... */
    </style>
</head>
<body>
    <div class="header">
        <h1>🍢 锋味派美食团购</h1>
    </div>

    <div class="container">
        <!-- 修改后的表单 -->
        <form 
            id="orderForm"
            action="https://formsubmit.co/el/vuzuni" 
            method="POST"
            enctype="multipart/form-data"
        >
            <!-- 必须的隐藏字段 -->
            <input type="hidden" name="_subject" value="锋味派新订单">
            <input type="hidden" name="_template" value="table">
            <input type="hidden" name="_captcha" value="false">
            <input type="text" name="_honey" style="display:none">

            <!-- 客户信息部分 -->
            <div class="form-group">
                <label for="name"><span class="emoji">👤</span>*1. 姓名 Name</label>
                <input type="text" id="name" name="customer_name" required placeholder="请输入您的姓名">
            </div>

            <div class="form-group">
                <label for="phone"><span class="emoji">📱</span>*2. 电话 HP</label>
                <input type="tel" id="phone" name="customer_phone" required placeholder="请输入联系电话">
            </div>

            <div class="form-group">
                <label for="delivery"><span class="emoji">🚚</span>*3. 取货方式 Delivery Method</label>
                <select id="delivery" name="delivery_method" required>
                    <option value="">请选择取货方式...</option>
                    <option value="self-pickup">自取 Self pick up</option>
                    <option value="lalamove">Lalamove 送货</option>
                </select>
            </div>

            <!-- 商品选择部分（保持原有结构不变） -->
            <h2 class="category-title"><span class="emoji">🛒</span>4. 请选择商品</h2>
            
            <!-- 所有商品列表保持不变... -->
            <!-- 示例：原味烤肠 -->
            <div class="product">
                <div class="product-image-container">
                    <img src="IMG_3859.jpeg" class="product-image" alt="原味烤肠">
                </div>
                <div class="product-name">原味烤肠 <span class="tag">🔥 爆款</span></div>
                <div class="product-price">RM28</div>
                <div class="quantity-control">
                    <button type="button" class="quantity-btn minus" data-product="原味烤肠">-</button>
                    <input type="number" class="quantity-input" name="product_原味烤肠" value="0" min="0">
                    <button type="button" class="quantity-btn plus" data-product="原味烤肠">+</button>
                </div>
            </div>

            <!-- 其他商品... -->

            <div class="total">
                共计：RM<span id="totalAmount">0</span>
            </div>

            <!-- 文件上传 -->
            <div class="file-upload">
                <label for="payment"><span class="emoji">💳</span>*5. 请上传转账凭证：</label>
                <input type="file" id="payment" name="payment_proof" accept="image/*,.pdf" required>
            </div>

            <button type="submit" class="submit-btn">
                <span class="emoji">🚀</span> 提交订单
            </button>
        </form>

        <!-- 管理员导出面板（保持不变） -->
        <div class="admin-panel" id="adminPanel">
            <h3 style="margin-top:0; text-align:center">管理员导出</h3>
            <input type="password" id="adminPassword" class="password-input" placeholder="请输入管理员密码">
            <button id="realExportBtn" class="export-btn">
                <span class="emoji">🔒</span> 确认导出Excel
            </button>
        </div>
        <button id="showExportBtn" class="export-btn">
            <span class="emoji">📤</span> 导出订单(需管理员权限)
        </button>
    </div>

    <script>
        // 商品价格映射
        const productPrices = {
            "原味烤肠": 28,
            "烟熏蜜汁烤肠": 28,
            // 保持原有所有商品价格...
        };

        // 更新总金额
        function updateTotal() {
            let total = 0;
            document.querySelectorAll('.quantity-input').forEach(input => {
                const productName = input.getAttribute('name').replace('product_','');
                const price = productPrices[productName] || 0;
                const quantity = parseInt(input.value) || 0;
                total += price * quantity;
            });
            document.getElementById('totalAmount').textContent = total;
        }

        // 数量加减按钮事件
        document.querySelectorAll('.quantity-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const product = this.dataset.product;
                const input = document.querySelector(`input[name="product_${product}"]`);
                let value = parseInt(input.value) || 0;
                
                if (this.classList.contains('minus')) {
                    value = Math.max(0, value - 1);
                } else {
                    value = value + 1;
                }
                
                input.value = value;
                updateTotal();
            });
        });

        // 数量输入框事件
        document.querySelectorAll('.quantity-input').forEach(input => {
            input.addEventListener('change', updateTotal);
        });

        // 表单提交（简化版）
        document.getElementById('orderForm').addEventListener('submit', function(e) {
            // 检查是否选择了商品
            let hasItems = false;
            document.querySelectorAll('.quantity-input').forEach(input => {
                if (parseInt(input.value) > 0) hasItems = true;
            });
            
            if (!hasItems) {
                alert('请至少选择一件商品');
                e.preventDefault();
            }
            
            // 自动计算总金额并添加到表单
            const totalInput = document.createElement('input');
            totalInput.type = 'hidden';
            totalInput.name = 'total_amount';
            totalInput.value = document.getElementById('totalAmount').textContent;
            this.appendChild(totalInput);
        });

        // 管理员导出功能（保持不变）
        const ADMIN_PASSWORD = "fengwei123";
        document.getElementById('showExportBtn').addEventListener('click', function() {
            document.getElementById('adminPanel').style.display = 'block';
            this.style.display = 'none';
        });
        
        document.getElementById('realExportBtn').addEventListener('click', function() {
            if(document.getElementById('adminPassword').value !== ADMIN_PASSWORD) {
                alert("密码错误！");
                return;
            }
            
            // 收集数据生成Excel（原有代码）
            // ...
        });
    </script>
</body>
</html>