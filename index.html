<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é”‹å‘³æ´¾ç¾é£Ÿå›¢è´­</title>
    <meta name="description" content="é”‹å‘³æ´¾ç¾é£Ÿå›¢è´­å¹³å° - æ–°é²œç¾é£Ÿï¼Œå›¢è´­ä¼˜æƒ " />
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>å¤„ç†ä¸­...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <h1><i class="fas fa-utensils"></i> é”‹å‘³æ´¾ç¾é£Ÿå›¢è´­</h1>
        <p class="header-subtitle">æ–°é²œç¾é£Ÿï¼Œå›¢è´­ä¼˜æƒ </p>
    </header>

    <!-- Category Navigation -->
    <nav class="category-nav" id="categoryNav">
        <div class="category-links">
            <a href="#all" class="category-link active" data-category="all">å…¨éƒ¨</a>
            <a href="#sausage" class="category-link" data-category="çƒ¤è‚ ç³»åˆ—">ğŸŒ­ çƒ¤è‚ ç³»åˆ—</a>
            <a href="#shrimp" class="category-link" data-category="è™¾è‚ ç³»åˆ—">ğŸ¦ è™¾è‚ ç³»åˆ—</a>
            <a href="#pizza" class="category-link" data-category="æŠ«è¨ç³»åˆ—">ğŸ• æŠ«è¨ç³»åˆ—</a>
            <a href="#dumpling" class="category-link" data-category="å°ç¬¼æ±¤åŒ…ç³»åˆ—">ğŸ¥Ÿ å°ç¬¼æ±¤åŒ…ç³»åˆ—</a>
            <a href="#pastry" class="category-link" data-category="é…¥é¥¼ç³»åˆ—">ğŸ¥® é…¥é¥¼ç³»åˆ—</a>
            <a href="#chicken" class="category-link" data-category="é¸¡æ’ç³»åˆ—">ğŸ— é¸¡æ’ç³»åˆ—</a>
            <a href="#wings" class="category-link" data-category="é¸¡ç¿…ç³»åˆ—">ğŸ— é¸¡ç¿…ç³»åˆ—</a>
            <a href="#shumai" class="category-link" data-category="çº¸çš®çƒ§å–ç³»åˆ—">ğŸ¥Ÿ çº¸çš®çƒ§å–ç³»åˆ—</a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Important Notice - é‡è¦å£°æ˜ -->
        <section class="disclaimer-box">
            <h3><i class="fas fa-exclamation-triangle"></i> é‡è¦å£°æ˜ / Important Notice</h3>
            <ul>
                <li>æ­¤ä¸ºé¢„è´­å•†å“ï¼Œè®¢å•æ±‡æ€»åç»Ÿä¸€å‘ä¾›åº”å•†è®¢è´­</li>
                <li>This is a pre-order. We will place the bulk order after collecting all purchases</li>
                <li>é¢„è®¡ç­‰å¾…æ—¶é—´ï¼š30-60å¤©ï¼ˆä»ä¸‹å•æ—¥èµ·è®¡ç®—ï¼‰</li>
                <li>Estimated waiting time: 30-60 days (from order date)</li>
                <li>å½“å‰ä»·æ ¼<strong>ä¸åŒ…å«</strong>å›½é™…è¿è´¹ï¼Œè¿è´¹å°†æ ¹æ®å®é™…ç‰©æµæˆæœ¬åç»­é€šçŸ¥æ”¶å–</li>
                <li>Current prices <strong>DO NOT INCLUDE</strong> international shipping fees</li>
                <li>ä»˜æ¬¾åè¯·ä¿ç•™å‡­è¯ï¼Œä»¥ä¾¿æŸ¥è¯¢è®¢å•çŠ¶æ€</li>
                <li>å•†å“ä»·æ ¼å¯èƒ½å› å¸‚åœºæƒ…å†µæœ‰æ‰€è°ƒæ•´</li>
            </ul>
            
            <div class="disclaimer-checkbox">
                <input type="checkbox" id="agreeTerms" required>
                <label for="agreeTerms">
                    æˆ‘å·²é˜…è¯»å¹¶åŒæ„ä¸Šè¿°æ¡æ¬¾ / I have read and agree to the terms <span class="required">*</span>
                </label>
            </div>
            <div class="error-message">è¯·å‹¾é€‰æ­¤é¡¹ä»¥ç»§ç»­ / Please check this box to continue</div>
        </section>

        <!-- Order Form - å®¢æˆ·èµ„æ–™ -->
        <section class="container" id="orderForm">
            <h2 class="section-title">
                <i class="fas fa-user-edit"></i>
                è®¢å•ä¿¡æ¯
            </h2>

            <form id="mainForm" novalidate>
                <!-- Personal Information -->
                <div class="form-group">
                    <label for="customerName">
                        <i class="fas fa-user"></i>
                        å§“å <span class="required">*</span>
                    </label>
                    <input type="text" id="customerName" name="customerName" required 
                           placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" autocomplete="name">
                    <div class="error-message">è¯·è¾“å…¥æœ‰æ•ˆçš„å§“å</div>
                </div>

                <div class="form-group">
                    <label for="customerPhone">
                        <i class="fas fa-phone"></i>
                        ç”µè¯ <span class="required">*</span>
                    </label>
                    <input type="tel" id="customerPhone" name="customerPhone" required 
                           placeholder="è¯·è¾“å…¥æ‚¨çš„ç”µè¯å·ç " autocomplete="tel">
                    <div class="error-message">è¯·è¾“å…¥æœ‰æ•ˆçš„ç”µè¯å·ç </div>
                </div>

                <div class="form-group">
                    <label for="deliveryAddress">
                        <i class="fas fa-map-marker-alt"></i>
                        é…é€åœ°å€ <span class="required">*</span>
                    </label>
                    <textarea id="deliveryAddress" name="deliveryAddress" required 
                              placeholder="è¯·è¾“å…¥è¯¦ç»†çš„é…é€åœ°å€" autocomplete="street-address"></textarea>
                    <div class="error-message">è¯·è¾“å…¥é…é€åœ°å€</div>
                </div>

                <div class="form-group">
                    <label for="specialRequests">
                        <i class="fas fa-comment"></i>
                        ç‰¹æ®Šè¦æ±‚
                    </label>
                    <textarea id="specialRequests" name="specialRequests" 
                              placeholder="å¦‚æœ‰ç‰¹æ®Šè¦æ±‚è¯·åœ¨æ­¤è¯´æ˜ï¼ˆå¯é€‰ï¼‰"></textarea>
                </div>

                <!-- Payment Information -->
                <div class="form-group">
                    <label for="deliveryMethod">
                        <i class="fas fa-truck"></i>
                        å–è´§æ–¹å¼ / Delivery Method <span class="required">*</span>
                    </label>
                    <select id="deliveryMethod" name="deliveryMethod" required>
                        <option value="">è¯·é€‰æ‹© / Please select</option>
                        <option value="self-pickup">è‡ªå– Self pickup</option>
                        <option value="lalamove">Lalamove é€è´§</option>
                    </select>
                    <div id="selfPickupAddress" class="pickup-address" style="display: none;">
                        <h4>è‡ªå–åœ°å€ / Pickup Address:</h4>
                        <p>667, Jalan 24,</p>
                        <p>Taman Perindustrian Ehsan Jaya, Kepong,</p>
                        <p>52100, Kuala Lumpur.</p>
                        <p><strong>å–è´§æ—¶é—´ / Pickup Time:</strong> å¦è¡Œé€šçŸ¥</p>
                        <p><strong>è”ç»œå·ç  / Contact:</strong> 0162327792</p>
                    </div>
                    <div class="error-message">è¯·é€‰æ‹©å–è´§æ–¹å¼ / Please select a delivery method</div>
                </div>


            </form>
        </section>

        <!-- Products Section -->
        <section class="container" id="productsSection">
            <h2 class="section-title">
                <i class="fas fa-shopping-basket"></i>
                ğŸ›’ è¯·é€‰æ‹©å•†å“
            </h2>
            
            <!-- Search Bar -->

            
            <div id="productList" class="product-list">
                <!-- Products will be loaded dynamically -->
            </div>

            <!-- Cart Summary -->
            <div class="cart-summary" id="cartSummary">
                <div class="total">
                    æ€»è®¡: <span id="totalAmount">RM0</span>
                </div>
                <div class="item-count">
                    å…± <span id="itemCount">0</span> ä»¶å•†å“
                </div>
            </div>
        </section>

        <!-- Payment Information -->
        <section class="container">
            <h2 class="section-title">
                <i class="fas fa-credit-card"></i>
                ğŸ’³ ä»˜æ¬¾ä¿¡æ¯ / Payment Info
            </h2>
            
            <!-- Payment Method Selection -->
            <div class="form-group">
                <label for="paymentMethod">
                    <i class="fas fa-credit-card"></i>
                    é€‰æ‹©ä»˜æ¬¾æ–¹å¼ / Select Payment Method <span class="required">*</span>
                </label>
                <select id="paymentMethod" name="paymentMethod" required>
                    <option value="">è¯·é€‰æ‹©ä»˜æ¬¾æ–¹å¼ / Please select</option>
                    <option value="maybank">Maybank è½¬è´¦</option>
                    <option value="touchngo">Touch n Go eWallet</option>
                </select>
                <div class="error-message">è¯·é€‰æ‹©ä»˜æ¬¾æ–¹å¼ / Please select payment method</div>
            </div>
            
            <!-- Payment Details -->
            <div id="paymentDetails" style="display: none;">
                <div class="bank-info">
                    <div id="maybankDetails" style="display: none;">
                        <h4><i class="fas fa-university"></i> Maybank è½¬è´¦ä¿¡æ¯</h4>
                        <p><strong>é“¶è¡Œåç§° / Bank:</strong> Maybank</p>
                        <p><strong>æˆ·å£å / Account Name:</strong> Choong Sher Lee</p>
                        <p><strong>æˆ·å£å·ç  / Account No.:</strong> 114209540438</p>
                        <p><strong>å¤‡æ³¨:</strong> è¯·åœ¨è½¬è´¦å¤‡æ³¨ä¸­å¡«å†™æ‚¨çš„å§“åå’Œç”µè¯</p>
                        

                        
                        <div class="qr-code-item">
                            <h4>Maybank QR Code</h4>
                            <div class="qr-placeholder">
                                <i class="fas fa-qrcode"></i>
                                <p>æ‰«æäºŒç»´ç è½¬è´¦</p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="touchngoDetails" style="display: none;">
                        <h4><i class="fas fa-mobile-alt"></i> Touch n Go eWallet</h4>
                        <p><strong>æ”¶æ¬¾äºº:</strong> Choong Sher Lee</p>
                        <p><strong>æ‰‹æœºå·ç :</strong> +60162327792</p>
                        
                        <div class="payment-action">
                            <button type="button" class="btn btn-secondary" id="touchngoPayBtn">
                                <i class="fas fa-mobile-alt"></i>
                                æ‰“å¼€ Touch n Go App
                            </button>
                        </div>
                        
                        <div class="qr-code-item">
                            <h4>Touch n Go QR Code</h4>
                            <div class="qr-placeholder">
                                <i class="fas fa-qrcode"></i>
                                <p>æ‰«æäºŒç»´ç ä»˜æ¬¾</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Payment Proof Upload -->
            <div class="form-group" id="paymentProofSection" style="display: none;">
                <label for="paymentProof">
                    <i class="fas fa-upload"></i>
                    ä¸Šä¼ ä»˜æ¬¾å‡­è¯ / Upload Payment Proof <span class="required">*</span>
                </label>
                <div class="file-upload">
                    <input type="file" id="paymentProof" name="paymentProof" 
                           accept="image/*" required>
                    <label for="paymentProof" class="file-upload-label">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <div class="upload-text">ç‚¹å‡»ä¸Šä¼ ä»˜æ¬¾å‡­è¯</div>
                        <div class="upload-hint">æ”¯æŒ JPG, PNG, GIF æ ¼å¼</div>
                        <span class="file-name"></span>
                    </label>
                </div>
                <div class="error-message">è¯·ä¸Šä¼ ä»˜æ¬¾å‡­è¯</div>
                
                <p style="margin-top:15px;font-size:14px;color:#666;">
                    âš ï¸ å®Œæˆä»˜æ¬¾åï¼Œè¯·ä¸Šä¼ è½¬è´¦å‡­è¯ä»¥ä¾¿æˆ‘ä»¬ç¡®è®¤æ‚¨çš„è®¢å•
                </p>
            </div>
        </section>



        <!-- Submit Button -->
        <button type="submit" class="btn submit-btn" id="submitBtn" form="mainForm">
            <i class="fas fa-paper-plane"></i>
            æäº¤è®¢å•
        </button>
    </main>

    <!-- Confirmation Dialog -->
    <div id="confirmationDialog" class="dialog-overlay" role="dialog" aria-labelledby="confirmTitle" aria-modal="true">
        <div class="dialog-content" id="confirmationContent">
            <div class="dialog-header">
                <h3 id="confirmTitle"><i class="fas fa-check-circle"></i> ç¡®è®¤è®¢å•</h3>
                <button type="button" class="dialog-close" id="closeConfirmation" aria-label="å…³é—­å¯¹è¯æ¡†">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="dialog-body">
                <div id="orderSummary"></div>
                <p class="confirmation-text">è¯·ç¡®è®¤ä»¥ä¸Šä¿¡æ¯æ— è¯¯åæäº¤è®¢å•</p>
            </div>
            
            <div class="dialog-footer">
                <button type="button" class="btn btn-secondary" id="cancelOrder">å–æ¶ˆ</button>
                <button type="button" class="btn" id="confirmOrder">ç¡®è®¤æäº¤</button>
            </div>
        </div>
    </div>

    <!-- Success Dialog -->
    <div id="successDialog" class="dialog-overlay" role="dialog" aria-labelledby="successTitle" aria-modal="true">
        <div class="dialog-content" id="successContent">
            <div class="dialog-header">
                <h3 id="successTitle"><i class="fas fa-check-circle success-icon"></i> è®¢å•æäº¤æˆåŠŸ</h3>
            </div>
            
            <div class="dialog-body">
                <p>æ‚¨çš„è®¢å•å·²æˆåŠŸæäº¤ï¼</p>
                <p>è®¢å•å·: <strong id="orderNumber"></strong></p>
                <p>æˆ‘ä»¬ä¼šå°½å¿«å¤„ç†æ‚¨çš„è®¢å•ï¼Œè¯·ä¿æŒç”µè¯ç•…é€šã€‚</p>
            </div>
            
            <div class="dialog-footer">
                <button type="button" class="btn" id="closeSuccess">å®Œæˆ</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Admin Section -->
    <div class="admin-section">
        <button class="btn btn-secondary" id="showExportBtn">
            <i class="fas fa-download"></i>
            ğŸ“¤ ç®¡ç†å‘˜å¯¼å‡ºè®¢å• (éœ€å¯†ç )
        </button>
        <div id="adminPanel" style="display:none;">
            <input type="password" id="adminPassword" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç " />
            <button class="btn btn-secondary" id="realExportBtn">
                <i class="fas fa-file-excel"></i>
                ğŸ“¥ å¯¼å‡º Excel
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="scripts/supabase-config.js"></script>
    <script src="scripts/validation.js"></script>
    <script src="scripts/app.js"></script>
</body>
</html>

// Main Application Logic
class FoodOrderApp {
    constructor() {
        this.cart = new Map();
        this.products = [];
        this.validator = new FormValidator();
        this.currentCategory = 'all';
        this.searchQuery = '';
        
        this.initializeApp();
    }
    
    async initializeApp() {
        try {
            this.showLoading(true);
            await this.loadProducts();
            this.setupEventListeners();
            this.renderProducts();
            this.updateCartSummary();
            this.showLoading(false);
            
            this.showToast('åº”ç”¨åŠ è½½æˆåŠŸ', 'success');
        } catch (error) {
            console.error('Failed to initialize app:', error);
            this.showToast('åº”ç”¨åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
            this.showLoading(false);
        }
    }
    
    async loadProducts() {
        // å®Œæ•´çš„äº§å“æ•°æ® - ä»åŸå§‹HTMLæ–‡ä»¶æ¢å¤
        this.products = [
            { id: 1, name: 'åŸå‘³çƒ¤è‚ ', price: 28, image: 'IMG_3859.jpeg', category: 'çƒ¤è‚ ç³»åˆ—', emoji: 'ğŸŒ­', description: 'ç»å…¸åŸå‘³çƒ¤è‚ ï¼Œä¼ ç»Ÿå·¥è‰ºåˆ¶ä½œ' },
            { id: 2, name: 'çƒŸç†èœœæ±çƒ¤è‚ ', price: 28, image: 'IMG_3864.jpeg', category: 'çƒ¤è‚ ç³»åˆ—', emoji: 'ğŸŒ­', description: 'çƒŸç†é£å‘³é…èœœæ±è°ƒæ–™ï¼Œé¦™ç”œå¯å£' },
            { id: 3, name: 'æ³•å¼é¦™è‰çƒ¤è‚ ', price: 28, image: 'IMG_3863.jpeg', category: 'çƒ¤è‚ ç³»åˆ—', emoji: 'ğŸŒ­', description: 'æ³•å¼é¦™è‰è°ƒå‘³ï¼Œå£æ„Ÿä¸°å¯Œ' },
            { id: 4, name: 'é»‘èƒ¡æ¤’çƒ¤è‚ ', price: 28, image: 'IMG_3860.jpeg', category: 'çƒ¤è‚ ç³»åˆ—', emoji: 'ğŸŒ­', description: 'æµ“éƒé»‘èƒ¡æ¤’å‘³ï¼Œå¾®è¾£çˆ½å£' },
            { id: 5, name: 'å­œç„¶è„†éª¨çƒ¤è‚ ', price: 28, image: 'IMG_3862.jpeg', category: 'çƒ¤è‚ ç³»åˆ—', emoji: 'ğŸŒ­', description: 'å­œç„¶è°ƒå‘³é…è„†éª¨ï¼Œå£æ„Ÿç‹¬ç‰¹' },
            { id: 6, name: 'èŠå£«ç‰ç±³çƒ¤è‚ ', price: 28, image: 'IMG_3861.jpeg', category: 'çƒ¤è‚ ç³»åˆ—', emoji: 'ğŸŒ­', description: 'é¦™æµ“èŠå£«é…ç‰ç±³ç²’ï¼Œå¥¶é¦™åè¶³' },
            { id: 7, name: 'åŸå‘³è™¾è‚ ', price: 33, image: 'IMG_3853.jpeg', category: 'è™¾è‚ ç³»åˆ—', emoji: 'ğŸ¦', description: 'æ–°é²œè™¾è‚‰åˆ¶ä½œï¼Œå£æ„ŸQå¼¹' },
            { id: 8, name: 'è¾£å‘³è™¾è‚ ', price: 33, image: 'IMG_3854.jpeg', category: 'è™¾è‚ ç³»åˆ—', emoji: 'ğŸ¦', description: 'å¾®è¾£è°ƒå‘³è™¾è‚ ï¼Œé²œè¾£å¼€èƒƒ' },
            { id: 9, name: 'åŸå‘³è™¾é¥¼', price: 28, image: 'IMG_3873.jpeg', category: 'è™¾è‚ ç³»åˆ—', emoji: 'ğŸ¤', description: 'è™¾è‚‰åˆ¶æˆé¥¼çŠ¶ï¼Œé…¥è„†å¯å£' },
            { id: 10, name: 'ç›æ ¼ä¸½ç‰¹æŠ«è¨', price: 25, image: 'IMG_3841.jpeg', category: 'æŠ«è¨ç³»åˆ—', emoji: 'ğŸ•', description: 'ç»å…¸ç›æ ¼ä¸½ç‰¹å£å‘³ï¼Œç®€å•ç¾å‘³' },
            { id: 11, name: 'é»‘æ¤’ç‰›è‚‰æŠ«è¨', price: 25, image: 'IMG_3839.jpeg', category: 'æŠ«è¨ç³»åˆ—', emoji: 'ğŸ•', description: 'é»‘èƒ¡æ¤’ç‰›è‚‰é…æ–™ï¼Œé¦™å‘³æµ“éƒ' },
            { id: 12, name: 'å¥¥å°”è‰¯é¸¡è‚‰æŠ«è¨', price: 25, image: 'IMG_3840.jpeg', category: 'æŠ«è¨ç³»åˆ—', emoji: 'ğŸ•', description: 'å¥¥å°”è‰¯é£å‘³é¸¡è‚‰ï¼Œé¦™è¾£ç¾å‘³' },
            { id: 13, name: 'åŒæ–™æ¦´è²æŠ«è¨', price: 40, image: 'IMG_3852.jpeg', category: 'æŠ«è¨ç³»åˆ—', emoji: 'ğŸ•', description: 'åŒå€æ¦´è²æœè‚‰ï¼Œæµ“éƒé¦™ç”œ' },
            { id: 14, name: 'é²œè‚‰å°ç¬¼æ±¤åŒ…', price: 12, image: 'IMG_3874.jpeg', category: 'å°ç¬¼æ±¤åŒ…ç³»åˆ—', emoji: 'ğŸ¥Ÿ', description: 'ä¼ ç»Ÿé²œè‚‰é¦…ï¼Œæ±¤æ±ä¸°å¯Œ' },
            { id: 15, name: 'èŒè‡å°ç¬¼æ±¤åŒ…', price: 12, image: 'IMG_3875.jpeg', category: 'å°ç¬¼æ±¤åŒ…ç³»åˆ—', emoji: 'ğŸ¥Ÿ', description: 'å¤šç§èŒè‡è°ƒå‘³ï¼Œæ¸…é¦™å¯å£' },
            { id: 16, name: 'é»‘æ¾éœ²å°ç¬¼æ±¤åŒ…', price: 12, image: 'IMG_3876.jpeg', category: 'å°ç¬¼æ±¤åŒ…ç³»åˆ—', emoji: 'ğŸ¥Ÿ', description: 'çè´µé»‘æ¾éœ²è°ƒå‘³ï¼Œé«˜ç«¯äº«å—' },
            { id: 17, name: 'é»‘çŒªè‚‰é…¥é¥¼', price: 55, image: 'IMG_3837.jpeg', category: 'é…¥é¥¼ç³»åˆ—', emoji: 'ğŸ¥®', description: 'ä¼˜è´¨é»‘çŒªè‚‰åˆ¶ä½œï¼Œé…¥è„†é¦™ç”œ' },
            { id: 18, name: 'å®‰æ ¼æ–¯ç‰›è‚‰é…¥é¥¼', price: 55, image: 'IMG_3838.jpeg', category: 'é…¥é¥¼ç³»åˆ—', emoji: 'ğŸ¥®', description: 'è¿›å£å®‰æ ¼æ–¯ç‰›è‚‰ï¼Œå“è´¨ä¸Šä¹˜' },
            { id: 19, name: 'åŸå‘³é¸¡æ’', price: 20, image: 'IMG_3835.jpeg', category: 'é¸¡æ’ç³»åˆ—', emoji: 'ğŸ—', description: 'åŸå‘³é¸¡æ’ï¼Œå¤–é…¥å†…å«©' },
            { id: 20, name: 'å¥¥å°”è‰¯é¸¡æ’', price: 20, image: 'IMG_3836.jpeg', category: 'é¸¡æ’ç³»åˆ—', emoji: 'ğŸ—', description: 'å¥¥å°”è‰¯é£å‘³è°ƒæ–™ï¼Œé¦™è¾£è¯±äºº' },
            { id: 21, name: 'å¥¥å°”è‰¯é¸¡ç¿…', price: 25, image: 'IMG_3865.jpeg', category: 'é¸¡ç¿…ç³»åˆ—', emoji: 'ğŸ—', description: 'å¥¥å°”è‰¯é£å‘³é¸¡ç¿…ï¼Œå«©æ»‘å¤šæ±' },
            { id: 22, name: 'é’èŠ±æ¤’é¸¡ç¿…', price: 25, image: 'IMG_3866.jpeg', category: 'é¸¡ç¿…ç³»åˆ—', emoji: 'ğŸ—', description: 'é’èŠ±æ¤’è°ƒå‘³ï¼Œéº»é¦™å›å‘³' },
            { id: 23, name: 'é»‘çŒªä¸‰ä¸çº¸çš®çƒ§å–', price: 15, image: 'IMG_3843.jpeg', category: 'çº¸çš®çƒ§å–ç³»åˆ—', emoji: 'ğŸ¥Ÿ', description: 'é»‘çŒªè‚‰ä¸‰ä¸é¦…ï¼Œçº¸çš®åŒ…è£¹' },
            { id: 24, name: 'é»‘æ¤’ç‰›è‚‰çº¸çš®çƒ§å–', price: 15, image: 'IMG_3842.jpeg', category: 'çº¸çš®çƒ§å–ç³»åˆ—', emoji: 'ğŸ¥Ÿ', description: 'é»‘æ¤’ç‰›è‚‰é¦…ï¼Œé¦™è¾£ç¾å‘³' },
            { id: 25, name: 'é»‘çŒªæ¢…èœå¹²çº¸çš®çƒ§å–', price: 15, image: 'IMG_3844.jpeg', category: 'çº¸çš®çƒ§å–ç³»åˆ—', emoji: 'ğŸ¥Ÿ', description: 'æ¢…èœå¹²é…é»‘çŒªè‚‰ï¼Œç»å…¸æ­é…' },
            { id: 26, name: 'ä¸‰ä¸èŠå£«çº¸çš®çƒ§å–', price: 15, image: 'IMG_3845.jpeg', category: 'çº¸çš®çƒ§å–ç³»åˆ—', emoji: 'ğŸ¥Ÿ', description: 'ä¸‰ä¸é…èŠå£«ï¼Œå¥¶é¦™æµ“éƒ' },
            { id: 27, name: 'ä¹Œç±³è…Šå‘³çº¸çš®çƒ§å–', price: 15, image: 'IMG_3846.jpeg', category: 'çº¸çš®çƒ§å–ç³»åˆ—', emoji: 'ğŸ¥Ÿ', description: 'ä¹Œç±³é…è…Šå‘³ï¼Œä¼ ç»Ÿé£å‘³' }
        ];
    }
    
    setupEventListeners() {
        // Category navigation
        document.querySelectorAll('.category-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                this.handleCategoryChange(link.dataset.category);
            });
        });
        
        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        
        if (searchInput) {
            searchInput.addEventListener('input', this.debounce((e) => {
                this.handleSearch(e.target.value);
            }, 300));
            
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    this.handleSearch(e.target.value);
                }
            });
        }
        
        if (searchBtn) {
            searchBtn.addEventListener('click', () => {
                this.handleSearch(searchInput.value);
            });
        }
        
        // Form submission
        const mainForm = document.getElementById('mainForm');
        if (mainForm) {
            mainForm.addEventListener('submit', (e) => {
                e.preventDefault();
                this.handleFormSubmit();
            });
        }
        
        // File upload
        const paymentProof = document.getElementById('paymentProof');
        if (paymentProof) {
            paymentProof.addEventListener('change', this.handleFileUpload.bind(this));
        }
        
        // Phone formatting
        const phoneInput = document.getElementById('customerPhone');
        if (phoneInput) {
            phoneInput.addEventListener('input', (e) => {
                e.target.value = PhoneFormatter.format(e.target.value);
            });
        }
        
        // Real-time validation
        this.setupRealTimeValidation();
        
        // Delivery method selection
        this.setupDeliveryMethodHandling();
        
        // Payment method selection
        this.setupPaymentMethodHandling();
        
        // Dialog controls
        this.setupDialogControls();
        
        // Admin controls
        this.setupAdminControls();
        
        // Terms checkbox
        const agreeTerms = document.getElementById('agreeTerms');
        if (agreeTerms) {
            agreeTerms.addEventListener('change', () => {
                this.validator.clearFieldError('agreeTerms');
                const disclaimerBox = document.querySelector('.disclaimer-box');
                if (disclaimerBox) {
                    disclaimerBox.classList.remove('error');
                }
            });
        }
    }
    
    setupRealTimeValidation() {
        const fields = ['customerName', 'customerPhone', 'deliveryAddress', 'deliveryMethod', 'paymentMethod'];
        
        fields.forEach(fieldName => {
            const field = document.getElementById(fieldName);
            if (field) {
                field.addEventListener('blur', () => {
                    this.validateSingleField(fieldName);
                });
                
                field.addEventListener('input', () => {
                    if (field.classList.contains('error')) {
                        this.validator.clearFieldError(fieldName);
                    }
                });
            }
        });
    }
    
    setupDeliveryMethodHandling() {
        const deliveryMethod = document.getElementById('deliveryMethod');
        const selfPickupAddress = document.getElementById('selfPickupAddress');
        
        if (deliveryMethod && selfPickupAddress) {
            deliveryMethod.addEventListener('change', (e) => {
                if (e.target.value === 'self-pickup') {
                    selfPickupAddress.style.display = 'block';
                } else {
                    selfPickupAddress.style.display = 'none';
                }
            });
        }
    }
    
    setupPaymentMethodHandling() {
        const paymentMethod = document.getElementById('paymentMethod');
        const paymentDetails = document.getElementById('paymentDetails');
        const maybankDetails = document.getElementById('maybankDetails');
        const touchngoDetails = document.getElementById('touchngoDetails');
        const paymentProofSection = document.getElementById('paymentProofSection');
        
        if (paymentMethod) {
            paymentMethod.addEventListener('change', (e) => {
                const selectedMethod = e.target.value;
                
                // Hide all details first
                if (paymentDetails) paymentDetails.style.display = 'none';
                if (maybankDetails) maybankDetails.style.display = 'none';
                if (touchngoDetails) touchngoDetails.style.display = 'none';
                if (paymentProofSection) paymentProofSection.style.display = 'none';
                
                // Show relevant details based on selection
                if (selectedMethod) {
                    if (paymentDetails) paymentDetails.style.display = 'block';
                    if (paymentProofSection) paymentProofSection.style.display = 'block';
                    
                    if (selectedMethod === 'maybank' && maybankDetails) {
                        maybankDetails.style.display = 'block';
                    } else if (selectedMethod === 'touchngo' && touchngoDetails) {
                        touchngoDetails.style.display = 'block';
                    }
                }
            });
        }
        
        // Setup payment buttons
        const touchngoPayBtn = document.getElementById('touchngoPayBtn');
        

        
        if (touchngoPayBtn) {
            touchngoPayBtn.addEventListener('click', () => {
                // Try to open Touch n Go app (mobile) or website
                if (this.isMobileDevice()) {
                    // Try to open the app first
                    window.location.href = 'touchngo://';
                    
                    // Fallback to website if app is not installed
                    setTimeout(() => {
                        window.open('https://www.touchngo.com.my/ewallet/', '_blank');
                    }, 1000);
                } else {
                    // Open website on desktop
                    window.open('https://www.touchngo.com.my/ewallet/', '_blank');
                }
                this.showToast('è¯·å®Œæˆ Touch n Go ä»˜æ¬¾åä¸Šä¼ å‡­è¯', 'info');
            });
        }
    }
    
    isMobileDevice() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }
    
    validateSingleField(fieldName) {
        const field = document.getElementById(fieldName);
        if (!field) return;
        
        const value = field.value;
        const isValid = this.validator.validateField(fieldName, value);
        
        if (!isValid) {
            this.validator.showFieldError(fieldName, this.validator.getError(fieldName));
        } else {
            this.validator.clearFieldError(fieldName);
        }
    }
    
    setupDialogControls() {
        // Confirmation dialog
        const closeConfirmation = document.getElementById('closeConfirmation');
        const cancelOrder = document.getElementById('cancelOrder');
        const confirmOrder = document.getElementById('confirmOrder');
        
        if (closeConfirmation) {
            closeConfirmation.addEventListener('click', () => this.hideDialog('confirmationDialog'));
        }
        
        if (cancelOrder) {
            cancelOrder.addEventListener('click', () => this.hideDialog('confirmationDialog'));
        }
        
        if (confirmOrder) {
            confirmOrder.addEventListener('click', () => this.submitOrder());
        }
        
        // Success dialog
        const closeSuccess = document.getElementById('closeSuccess');
        if (closeSuccess) {
            closeSuccess.addEventListener('click', () => {
                this.hideDialog('successDialog');
                this.resetForm();
            });
        }
        
        // Close dialogs on overlay click
        document.querySelectorAll('.dialog-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    this.hideDialog(overlay.id);
                }
            });
        });
        
        // Escape key to close dialogs
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const openDialog = document.querySelector('.dialog-overlay.show');
                if (openDialog) {
                    this.hideDialog(openDialog.id);
                }
            }
        });
    }
    
    handleCategoryChange(category) {
        this.currentCategory = category;
        
        // Update active link
        document.querySelectorAll('.category-link').forEach(link => {
            link.classList.toggle('active', link.dataset.category === category);
        });
        
        this.renderProducts();
    }
    

    
    renderProducts() {
        const productList = document.getElementById('productList');
        if (!productList) return;
        
        let filteredProducts = this.products;
        
        // Filter by category
        if (this.currentCategory !== 'all') {
            filteredProducts = filteredProducts.filter(product => 
                product.category === this.currentCategory
            );
        }
        

        
        if (filteredProducts.length === 0) {
            productList.innerHTML = `
                <div class="no-products">
                    <i class="fas fa-search"></i>
                    <p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å•†å“</p>
                    <button class="btn btn-secondary" onclick="app.clearFilters()">æ¸…é™¤ç­›é€‰</button>
                </div>
            `;
            return;
        }
        
        productList.innerHTML = filteredProducts.map(product => this.renderProduct(product)).join('');
        
        // Setup quantity controls
        this.setupQuantityControls();
    }
    
    renderProduct(product) {
        const quantity = this.cart.get(product.id) || 0;
        
        return `
            <div class="product" data-product-id="${product.id}">
                <div class="product-category">${product.emoji || 'âœ¨'} ${product.category}</div>
                <div class="product-image-container">
                    <div class="product-placeholder">
                        <span class="product-emoji">${product.emoji || 'ğŸ´'}</span>
                        <small>å›¾ç‰‡å³å°†ä¸Šä¼ </small>
                    </div>
                </div>
                <div class="product-name">${product.name}</div>
                <div class="product-description" style="font-size: 14px; color: #666; margin-bottom: 12px;">
                    ${product.description}
                </div>
                <div class="product-price">RM${product.price.toFixed(2)}</div>
                <div class="quantity-control">
                    <button class="quantity-btn" data-action="decrease" data-product-id="${product.id}" 
                            ${quantity === 0 ? 'disabled' : ''}>
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" class="quantity-input" value="${quantity}" 
                           data-product-id="${product.id}" min="0" max="99">
                    <button class="quantity-btn" data-action="increase" data-product-id="${product.id}">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
        `;
    }
    
    setupQuantityControls() {
        // Quantity buttons
        document.querySelectorAll('.quantity-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const productId = parseInt(btn.dataset.productId);
                const action = btn.dataset.action;
                this.updateQuantity(productId, action);
            });
        });
        
        // Quantity inputs
        document.querySelectorAll('.quantity-input').forEach(input => {
            input.addEventListener('change', (e) => {
                const productId = parseInt(input.dataset.productId);
                const quantity = Math.max(0, Math.min(99, parseInt(e.target.value) || 0));
                e.target.value = quantity;
                this.setQuantity(productId, quantity);
            });
        });
    }
    
    updateQuantity(productId, action) {
        const currentQuantity = this.cart.get(productId) || 0;
        let newQuantity = currentQuantity;
        
        if (action === 'increase') {
            newQuantity = Math.min(99, currentQuantity + 1);
        } else if (action === 'decrease') {
            newQuantity = Math.max(0, currentQuantity - 1);
        }
        
        this.setQuantity(productId, newQuantity);
    }
    
    setQuantity(productId, quantity) {
        if (quantity <= 0) {
            this.cart.delete(productId);
        } else {
            this.cart.set(productId, quantity);
        }
        
        // Update UI
        const quantityInput = document.querySelector(`.quantity-input[data-product-id="${productId}"]`);
        if (quantityInput) {
            quantityInput.value = quantity;
        }
        
        const decreaseBtn = document.querySelector(`.quantity-btn[data-action="decrease"][data-product-id="${productId}"]`);
        if (decreaseBtn) {
            decreaseBtn.disabled = quantity === 0;
        }
        
        this.updateCartSummary();
        
        // Show feedback
        const product = this.products.find(p => p.id === productId);
        if (product) {
            if (quantity > 0) {
                this.showToast(`å·²${quantity > (this.cart.get(productId) || 0) ? 'æ·»åŠ ' : 'æ›´æ–°'} ${product.name}`, 'success');
            } else {
                this.showToast(`å·²ç§»é™¤ ${product.name}`, 'info');
            }
        }
    }
    
    updateCartSummary() {
        const totalAmount = document.getElementById('totalAmount');
        const itemCount = document.getElementById('itemCount');
        
        let total = 0;
        let count = 0;
        
        this.cart.forEach((quantity, productId) => {
            const product = this.products.find(p => p.id === productId);
            if (product) {
                total += product.price * quantity;
                count += quantity;
            }
        });
        
        if (totalAmount) {
            totalAmount.textContent = `RM${total.toFixed(2)}`;
        }
        
        if (itemCount) {
            itemCount.textContent = count.toString();
        }
        
        // Show/hide cart summary
        const cartSummary = document.getElementById('cartSummary');
        if (cartSummary) {
            cartSummary.style.display = count > 0 ? 'block' : 'none';
        }
    }
    
    clearFilters() {
        this.currentCategory = 'all';
        this.searchQuery = '';
        
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.value = '';
        }
        
        document.querySelectorAll('.category-link').forEach(link => {
            link.classList.toggle('active', link.dataset.category === 'all');
        });
        
        this.renderProducts();
    }
    
    handleFileUpload(event) {
        const file = event.target.files[0];
        const label = event.target.nextElementSibling;
        const fileNameSpan = label.querySelector('.file-name');
        
        if (file) {
            // Validate file
            const isValid = this.validator.validateField('paymentProof', file.name, file);
            
            if (isValid) {
                fileNameSpan.textContent = `å·²é€‰æ‹©: ${file.name}`;
                this.validator.clearFieldError('paymentProof');
                this.showToast('ä»˜æ¬¾å‡­è¯ä¸Šä¼ æˆåŠŸ', 'success');
            } else {
                fileNameSpan.textContent = '';
                event.target.value = '';
                this.validator.showFieldError('paymentProof', this.validator.getError('paymentProof'));
                this.showToast(this.validator.getError('paymentProof'), 'error');
            }
        } else {
            fileNameSpan.textContent = '';
        }
    }
    
    async handleFormSubmit() {
        try {
            this.showLoading(true);
            
            // Validate cart
            if (this.cart.size === 0) {
                this.showToast('è¯·é€‰æ‹©å•†å“åå†æäº¤è®¢å•', 'warning');
                this.showLoading(false);
                return;
            }
            
            // Collect form data
            const formData = this.collectFormData();
            
            // Validate form
            if (!this.validator.validateForm(formData)) {
                this.showValidationErrors();
                this.showLoading(false);
                return;
            }
            
            // Show confirmation dialog
            this.showConfirmationDialog(formData);
            this.showLoading(false);
            
        } catch (error) {
            console.error('Form submission error:', error);
            this.showToast('è¡¨å•æäº¤å‡ºé”™ï¼Œè¯·é‡è¯•', 'error');
            this.showLoading(false);
        }
    }
    
    collectFormData() {
        const formElements = document.getElementById('mainForm').elements;
        const formData = {};
        
        // Collect form fields
        for (let element of formElements) {
            if (element.name) {
                if (element.type === 'checkbox') {
                    formData[element.name] = element.checked;
                } else if (element.type === 'file') {
                    formData[element.name + 'File'] = element.files[0];
                    formData[element.name] = element.files[0]?.name || '';
                } else {
                    formData[element.name] = element.value.trim();
                }
            }
        }
        
        // Add terms agreement
        const agreeTerms = document.getElementById('agreeTerms');
        formData.agreeTerms = agreeTerms ? agreeTerms.checked : false;
        
        // Add cart data
        formData.cart = Array.from(this.cart.entries()).map(([productId, quantity]) => {
            const product = this.products.find(p => p.id === productId);
            return {
                productId,
                name: product.name,
                price: product.price,
                quantity,
                total: product.price * quantity
            };
        });
        
        return formData;
    }
    
    showValidationErrors() {
        const errors = this.validator.getErrors();
        
        Object.keys(errors).forEach(fieldName => {
            this.validator.showFieldError(fieldName, errors[fieldName]);
        });
        
        // Show first error in toast
        const firstError = Object.values(errors)[0];
        this.showToast(firstError, 'error');
        
        // Scroll to first error
        const firstErrorElement = document.querySelector('.form-group.error, .disclaimer-box.error');
        if (firstErrorElement) {
            firstErrorElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }
    
    showConfirmationDialog(formData) {
        const dialog = document.getElementById('confirmationDialog');
        const orderSummary = document.getElementById('orderSummary');
        
        if (!dialog || !orderSummary) return;
        
        // Generate order summary
        let total = 0;
        const itemsHtml = formData.cart.map(item => {
            total += item.total;
            return `
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>${item.name} Ã— ${item.quantity}</span>
                    <span>Â¥${item.total.toFixed(2)}</span>
                </div>
            `;
        }).join('');
        
        orderSummary.innerHTML = `
            <div class="order-summary-section">
                <h4>è®¢å•å•†å“</h4>
                ${itemsHtml}
                <div style="border-top: 2px solid #eee; padding-top: 12px; margin-top: 12px; font-weight: bold;">
                    <div style="display: flex; justify-content: space-between;">
                        <span>æ€»è®¡</span>
                        <span style="color: var(--primary);">Â¥${total.toFixed(2)}</span>
                    </div>
                </div>
            </div>
            
            <div class="order-summary-section" style="margin-top: 20px;">
                <h4>é…é€ä¿¡æ¯</h4>
                <p><strong>å§“å:</strong> ${formData.customerName}</p>
                <p><strong>ç”µè¯:</strong> ${formData.customerPhone}</p>
                <p><strong>åœ°å€:</strong> ${formData.deliveryAddress}</p>
                ${formData.specialRequests ? `<p><strong>ç‰¹æ®Šè¦æ±‚:</strong> ${formData.specialRequests}</p>` : ''}
            </div>
            
            <div class="order-summary-section" style="margin-top: 20px;">
                <h4>ä»˜æ¬¾ä¿¡æ¯</h4>
                <p><strong>ä»˜æ¬¾æ–¹å¼:</strong> ${this.getPaymentMethodText(formData.paymentMethod)}</p>
                <p><strong>ä»˜æ¬¾å‡­è¯:</strong> ${formData.paymentProof}</p>
            </div>
        `;
        
        // Store form data for submission
        this.pendingOrderData = formData;
        
        this.showDialog('confirmationDialog');
    }
    
    getPaymentMethodText(method) {
        const methods = {
            'maybank': 'Maybank è½¬è´¦',
            'touchngo': 'Touch n Go eWallet'
        };
        return methods[method] || method;
    }
    
    async submitOrder() {
        try {
            this.showLoading(true);
            this.hideDialog('confirmationDialog');
            
            const orderData = this.prepareOrderData(this.pendingOrderData);
            
            // Check if Supabase is configured
            if (window.supabaseConfig && window.supabaseConfig.getClient()) {
                // Use real Supabase
                await this.submitToSupabase(orderData);
            } else {
                // Demo mode - simulate API call
                console.log('Demo mode: Order would be submitted:', orderData);
                await this.simulateApiCall();
            }
            
            // Generate order number
            const orderNumber = this.generateOrderNumber();
            
            // Show success dialog
            this.showSuccessDialog(orderNumber);
            
            this.showLoading(false);
            
        } catch (error) {
            console.error('Order submission error:', error);
            this.showToast('è®¢å•æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            this.showLoading(false);
        }
    }
    
    async submitToSupabase(orderData) {
        const client = window.supabaseConfig.getClient();
        
        // Upload payment proof if exists
        let paymentProofUrl = '';
        const fileInput = document.getElementById('paymentProof');
        if (fileInput && fileInput.files[0]) {
            paymentProofUrl = await window.supabaseConfig.uploadPaymentProof(
                fileInput.files[0], 
                orderData.orderNumber
            );
        }
        
        // Save order to database
        const { data, error } = await client
            .from('orders')
            .insert([{
                order_id: orderData.orderNumber,
                name: orderData.customerName,
                phone: orderData.customerPhone,
                delivery_method: orderData.deliveryMethod || orderData.deliveryAddress,
                remarks: orderData.specialRequests,
                order_items: orderData.items,
                total_amount: orderData.totalAmount,
                payment_proof_url: paymentProofUrl,
                status: 'pending',
                created_at: new Date().toISOString()
            }])
            .select();
            
        if (error) {
            throw error;
        }
        
        return data[0];
    }
    
    prepareOrderData(formData) {
        return {
            orderNumber: this.generateOrderNumber(),
            customerName: formData.customerName,
            customerPhone: formData.customerPhone,
            deliveryAddress: formData.deliveryAddress,
            specialRequests: formData.specialRequests,
            paymentMethod: formData.paymentMethod,
            items: formData.cart,
            totalAmount: formData.cart.reduce((sum, item) => sum + item.total, 0),
            status: 'pending',
            createdAt: new Date().toISOString()
        };
    }
    
    generateOrderNumber() {
        const date = new Date();
        const dateStr = date.getFullYear().toString() + 
                       (date.getMonth() + 1).toString().padStart(2, '0') + 
                       date.getDate().toString().padStart(2, '0');
        const timeStr = Date.now().toString().slice(-6);
        return `FW${dateStr}${timeStr}`;
    }
    
    async simulateApiCall() {
        // Simulate network delay
        return new Promise(resolve => setTimeout(resolve, 2000));
    }
    
    showSuccessDialog(orderNumber) {
        const dialog = document.getElementById('successDialog');
        const orderNumberElement = document.getElementById('orderNumber');
        
        if (orderNumberElement) {
            orderNumberElement.textContent = orderNumber;
        }
        
        this.showDialog('successDialog');
    }
    
    resetForm() {
        // Clear form
        const form = document.getElementById('mainForm');
        if (form) {
            form.reset();
        }
        
        // Clear cart
        this.cart.clear();
        
        // Clear file upload display
        const fileNameSpan = document.querySelector('.file-name');
        if (fileNameSpan) {
            fileNameSpan.textContent = '';
        }
        
        // Clear validation errors
        this.validator.clearAllErrors();
        
        // Update UI
        this.updateCartSummary();
        this.renderProducts();
        
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        this.showToast('è¡¨å•å·²é‡ç½®', 'info');
    }
    
    showDialog(dialogId) {
        const dialog = document.getElementById(dialogId);
        if (dialog) {
            dialog.classList.add('show');
            document.body.style.overflow = 'hidden';
            
            // Focus management for accessibility
            const firstFocusable = dialog.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            if (firstFocusable) {
                firstFocusable.focus();
            }
        }
    }
    
    hideDialog(dialogId) {
        const dialog = document.getElementById(dialogId);
        if (dialog) {
            dialog.classList.remove('show');
            document.body.style.overflow = '';
        }
    }
    
    showLoading(show) {
        const loadingOverlay = document.getElementById('loadingOverlay');
        if (loadingOverlay) {
            loadingOverlay.style.display = show ? 'flex' : 'none';
        }
    }
    
    showToast(message, type = 'info') {
        const toastContainer = document.getElementById('toastContainer');
        if (!toastContainer) return;
        
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        const icons = {
            success: 'fas fa-check-circle',
            error: 'fas fa-exclamation-circle',
            warning: 'fas fa-exclamation-triangle',
            info: 'fas fa-info-circle'
        };
        
        toast.innerHTML = `
            <i class="toast-icon ${icons[type]}"></i>
            <span class="toast-message">${message}</span>
            <button type="button" class="toast-close" onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        `;
        
        toastContainer.appendChild(toast);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            if (toast.parentElement) {
                toast.remove();
            }
        }, 5000);
    }
    
    setupAdminControls() {
        const showExportBtn = document.getElementById('showExportBtn');
        const adminPanel = document.getElementById('adminPanel');
        const realExportBtn = document.getElementById('realExportBtn');
        const adminPassword = document.getElementById('adminPassword');
        
        if (showExportBtn && adminPanel) {
            showExportBtn.addEventListener('click', () => {
                const isVisible = adminPanel.style.display !== 'none';
                adminPanel.style.display = isVisible ? 'none' : 'block';
            });
        }
        
        if (realExportBtn && adminPassword) {
            realExportBtn.addEventListener('click', () => {
                this.handleAdminExport(adminPassword.value);
            });
        }
    }
    
    async handleAdminExport(password) {
        const ADMIN_PASSWORD = 'fengweipaiadmin'; // åœ¨å®é™…åº”ç”¨ä¸­åº”è¯¥ä»ç¯å¢ƒå˜é‡è·å–
        
        if (password !== ADMIN_PASSWORD) {
            this.showToast('ç®¡ç†å‘˜å¯†ç é”™è¯¯ / Incorrect admin password', 'error');
            return;
        }
        
        try {
            this.showLoading(true);
            
            // ä» Supabase è·å–è®¢å•æ•°æ®
            const { data: orders, error } = await window.supabaseConfig.getClient()
                .from('orders')
                .select('*')
                .order('created_at', { ascending: false });
                
            if (error) {
                throw error;
            }
            
            // å‡†å¤‡Excelæ•°æ®
            const wsData = [
                ['è®¢å•å·', 'å§“å', 'ç”µè¯', 'é…é€æ–¹å¼', 'å¤‡æ³¨', 'æ€»é‡‘é¢', 'çŠ¶æ€', 'ä¸‹å•æ—¶é—´', 'æ”¯ä»˜å‡­è¯URL', 'äº§å“æ˜ç»†']
            ];
            
            orders.forEach(order => {
                const productDetails = Array.isArray(order.order_items)
                    ? order.order_items.map(item => `${item.product} x ${item.quantity} (RM${item.price.toFixed(2)})`).join('; ')
                    : 'N/A';
                    
                wsData.push([
                    order.order_id,
                    order.name,
                    order.phone,
                    order.delivery_method === 'self-pickup' ? 'è‡ªå–' : 'Lalamoveé€è´§',
                    order.remarks || 'æ— ',
                    `RM${order.total_amount.toFixed(2)}`,
                    order.status,
                    new Date(order.created_at).toLocaleString(),
                    order.payment_proof_url || 'æ— ',
                    productDetails
                ]);
            });
            
            // ä½¿ç”¨SheetJSå¯¼å‡ºExcel
            if (typeof XLSX !== 'undefined') {
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'è®¢å•æ•°æ®');
                XLSX.writeFile(wb, `é”‹å‘³æ´¾è®¢å•_${new Date().toISOString().slice(0, 10)}.xlsx`);
                
                this.showToast('å¯¼å‡ºæˆåŠŸ / Export successful', 'success');
            } else {
                throw new Error('Excel library not loaded');
            }
            
        } catch (error) {
            console.error('Export error:', error);
            this.showToast(`å¯¼å‡ºè®¢å•æ—¶å‡ºé”™: ${error.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
        } finally {
            this.showLoading(false);
        }
    }
    
    debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
}

// Initialize app when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    window.app = new FoodOrderApp();
});

// Service Worker registration for better performance
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        // Service worker would be implemented here for production
        console.log('Service Worker support detected');
    });
}
