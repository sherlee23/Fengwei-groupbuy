<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”‹å‘³æ´¾ç¾é£Ÿå›¢è´­</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #FF4757;
            --secondary: #FF6B81;
            --accent: #FFA502;
            --light: #F1F2F6;
            --dark: #2F3542;
        }
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
        }
        .header {
            text-align: center;
            padding: 25px 20px;
            background: white;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
        }
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        .container {
            padding: 0 20px 30px;
        }
        .product {
            background-color: white;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            border-left: 4px solid var(--primary);
        }
        .product:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .product-image-container {
            width: 100%;
            height: 200px;
            overflow: hidden;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f5f5f5;
        }
        .product-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .product-name {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 5px;
            color: var(--dark);
            display: flex;
            justify-content: space-between;
        }
        .product-price {
            color: var(--primary);
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .quantity-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            font-size: 18px;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .quantity-btn:hover {
            transform: scale(1.1);
        }
        .quantity-btn:active {
            transform: scale(0.95);
        }
        .quantity-input {
            width: 50px;
            height: 36px;
            text-align: center;
            margin: 0 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
        }
        .total {
            font-size: 20px;
            font-weight: bold;
            text-align: right;
            margin: 25px 0;
            padding: 18px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            color: var(--primary);
        }
        .form-group {
            margin-bottom: 22px;
        }
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 71, 87, 0.2);
        }
    input[type="text"],
    input[type="tel"],
    select,
    textarea {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    textarea {
      height: 48px;
      resize: vertical;
    }
        .file-upload {
            margin-top: 25px;
        }
        .file-upload label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
        }
        .file-upload input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 2px dashed #e0e0e0;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
        }
        .file-upload input[type="file"]:hover {
            border-color: var(--primary);
            background: rgba(255, 107, 129, 0.05);
        }
        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 25px;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(255, 71, 87, 0.3);
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 71, 87, 0.4);
        }
        .submit-btn:active {
            transform: translateY(0);
        }
        .export-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(to right, #6c757d, #495057);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(108, 117, 125, 0.3);
        }
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(108, 117, 125, 0.4);
        }
        .admin-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #e0e0e0;
            display: none;
        }
        .password-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 16px;
        }
        .category-title {
            font-size: 22px;
            margin: 30px 0 18px;
            padding-left: 12px;
            border-left: 5px solid var(--primary);
            color: var(--dark);
            font-weight: 700;
            position: relative;
        }
        .category-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 50px;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 3px;
        }
        .emoji {
            font-size: 20px;
            margin-right: 8px;
        }
        .tag {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            background-color: var(--accent);
            color: white;
        }
        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .input-error {
            border-color: #dc3545 !important;
        }
        .confirmation-title {
            margin-top: 0;
            color: var(--primary);
            text-align: center;
        }
        .confirmation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }
        .confirmation-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .confirmation-cancel {
            background-color: #6c757d;
            color: white;
        }
        .confirmation-submit {
            background-color: var(--primary);
            color: white;
        }
        .confirmation-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        #confirmationDialog {
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5); 
            z-index: 1000; 
            justify-content: center; 
            align-items: center;
        }
        #confirmationDialog > div {
            background: white; 
            padding: 25px; 
            border-radius: 12px; 
            max-width: 500px; 
            width: 90%; 
            max-height: 80vh; 
            overflow-y: auto;
        }
        #loadingOverlay {
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5); 
            z-index: 1001; 
            justify-content: center; 
            align-items: center; 
            color: white; 
            font-size: 24px;
        }
.disclaimer-box {
    background-color: #FFF3F3;
    border-left: 4px solid #FF4757;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 25px;
}
.disclaimer-title {
    color: #FF4757;
    margin-top: 0;
    font-size: 18px;
}
.disclaimer-content p {
    margin: 10px 0;
    line-height: 1.5;
}
.disclaimer-checkbox {
    margin-top: 15px;
    display: flex;
    align-items: center;
}
.disclaimer-checkbox input {
    width: 18px;
    height: 18px;
    accent-color: var(--primary); /* ä½¿å¤é€‰æ¡†ä¸ä¸»é¢˜è‰²ä¸€è‡´ */
    margin-right: 10px;
}

  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸ¢ é”‹å‘³æ´¾å›¢è´­è®¢å•</h1>

    <div class="container">
        <!-- è®¢å•ç¡®è®¤å¯¹è¯æ¡† -->
        <div id="confirmationDialog">
            <div>
                <div id="confirmationContent"></div>
            </div>
        </div>

        <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
        <div id="loadingOverlay">æ­£åœ¨æäº¤è®¢å•ï¼Œè¯·ç¨å€™...</div>

        <form id="orderForm">
    <div class="disclaimer-box">
        <h3 class="disclaimer-title">âš ï¸ é‡è¦å£°æ˜ / Important Notice</h3>
        <div class="disclaimer-content">
            <p>1. æ­¤ä¸ºé¢„è´­å•†å“ï¼Œæˆ‘ä»¬å°†æ”¶é›†æ‰€æœ‰è®¢å•åç»Ÿä¸€å‘ä¾›åº”å•†ä¸‹å•ã€‚</p>
            <p>1. This is a pre-order. We will place the bulk order after collecting all purchases.</p>
            <p>2. é¢„è®¡ç­‰å¾…æ—¶é—´ï¼š30-60å¤©ï¼ˆä»ä¸‹å•æ—¥èµ·è®¡ç®—ï¼‰ã€‚</p>
            <p>2. Estimated waiting time: 30-60 days (from order date).</p>
            <p>3. å½“å‰ä»·æ ¼<strong>ä¸åŒ…å«</strong>å›½é™…è¿è´¹ï¼Œè¿è´¹å°†æ ¹æ®å®é™…ç‰©æµæˆæœ¬åç»­é€šçŸ¥æ”¶å–ã€‚</p>
            <p>3. Current prices <strong>DO NOT INCLUDE</strong> international shipping fees. Fees will be calculated later.</p>
        </div>
        <div class="disclaimer-checkbox">
            <input type="checkbox" id="agreeCheckbox" required>
            <label for="agreeCheckbox">æˆ‘å·²é˜…è¯»å¹¶åŒæ„ä¸Šè¿°æ¡æ¬¾ / I have read and agree to the terms</label>
        </div>
    </div>

    <form id="orderForm">
      <!-- é¡¾å®¢èµ„æ–™ -->
      <div class="form-group">
        <label for="name">ğŸ‘¤ å§“å *</label>
        <input type="text" id="name" name="name" required />
        <div id="nameError" class="error-message"></div>
      </div>

      <div class="form-group">
        <label for="phone">ğŸ“± ç”µè¯ *</label>
        <input type="tel" id="phone" name="phone" required />
        <div id="phoneError" class="error-message"></div>
      </div>

      <div class="form-group">
        <label for="delivery">ğŸšš å–è´§æ–¹å¼ *</label>
        <select id="delivery" name="delivery" required>
          <option value="">è¯·é€‰æ‹©...</option>
          <option value="self-pickup">è‡ªå–</option>
          <option value="lalamove">Lalamove é€è´§</option>
        </select>
        <div id="deliveryError" class="error-message"></div>
      </div>

      <!-- å•†å“åŒºåŸŸ -->
      <h2 class="category-title">ğŸŒ­ çƒ¤è‚ ç³»åˆ—</h2>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3859.jpeg" class="product-image" alt="åŸå‘³çƒ¤è‚ " />
        </div>
        <div class="product-name">åŸå‘³çƒ¤è‚  <span class="tag">ğŸ”¥ çˆ†æ¬¾</span></div>
        <div class="product-price">RM28</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="åŸå‘³çƒ¤è‚ ">-</button>
          <input type="number" class="quantity-input" id="åŸå‘³çƒ¤è‚ " value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="åŸå‘³çƒ¤è‚ ">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3864.jpeg" class="product-image" alt="çƒŸç†èœœæ±çƒ¤è‚ " />
        </div>
        <div class="product-name">çƒŸç†èœœæ±çƒ¤è‚ </div>
        <div class="product-price">RM28</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="çƒŸç†èœœæ±çƒ¤è‚ ">-</button>
          <input type="number" class="quantity-input" id="çƒŸç†èœœæ±çƒ¤è‚ " value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="çƒŸç†èœœæ±çƒ¤è‚ ">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3863.jpeg" class="product-image" alt="æ³•å¼é¦™è‰çƒ¤è‚ " />
        </div>
        <div class="product-name">æ³•å¼é¦™è‰çƒ¤è‚ </div>
        <div class="product-price">RM28</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="æ³•å¼é¦™è‰çƒ¤è‚ ">-</button>
          <input type="number" class="quantity-input" id="æ³•å¼é¦™è‰çƒ¤è‚ " value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="æ³•å¼é¦™è‰çƒ¤è‚ ">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3860.jpeg" class="product-image" alt="é»‘èƒ¡æ¤’çƒ¤è‚ " />
        </div>
        <div class="product-name">é»‘èƒ¡æ¤’çƒ¤è‚ </div>
        <div class="product-price">RM28</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="é»‘èƒ¡æ¤’çƒ¤è‚ ">-</button>
          <input type="number" class="quantity-input" id="é»‘èƒ¡æ¤’çƒ¤è‚ " value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="é»‘èƒ¡æ¤’çƒ¤è‚ ">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3862.jpeg" class="product-image" alt="å­œç„¶è„†éª¨çƒ¤è‚ " />
        </div>
        <div class="product-name">å­œç„¶è„†éª¨çƒ¤è‚ </div>
        <div class="product-price">RM28</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="å­œç„¶è„†éª¨çƒ¤è‚ ">-</button>
          <input type="number" class="quantity-input" id="å­œç„¶è„†éª¨çƒ¤è‚ " value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="å­œç„¶è„†éª¨çƒ¤è‚ ">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3861.jpeg" class="product-image" alt="èŠå£«ç‰ç±³çƒ¤è‚ " />
        </div>
        <div class="product-name">èŠå£«ç‰ç±³çƒ¤è‚ </div>
        <div class="product-price">RM28</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="èŠå£«ç‰ç±³çƒ¤è‚ ">-</button>
          <input type="number" class="quantity-input" id="èŠå£«ç‰ç±³çƒ¤è‚ " value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="èŠå£«ç‰ç±³çƒ¤è‚ ">+</button>
        </div>
      </div>

      <!-- è™¾è‚ è™¾é¥¼ç³»åˆ— -->
      <h2 class="category-title">ğŸ¦ è™¾è‚  & è™¾é¥¼ç³»åˆ—</h2>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3853.jpeg" class="product-image" alt="åŸå‘³è™¾è‚ " />
        </div>
        <div class="product-name">åŸå‘³è™¾è‚  <span class="tag">ğŸ†• æ–°å“</span></div>
        <div class="product-price">RM33</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="åŸå‘³è™¾è‚ ">-</button>
          <input type="number" class="quantity-input" id="åŸå‘³è™¾è‚ " value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="åŸå‘³è™¾è‚ ">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3854.jpeg" class="product-image" alt="è¾£å‘³è™¾è‚ " />
        </div>
        <div class="product-name">è¾£å‘³è™¾è‚  <span class="tag">ğŸŒ¶ï¸ çƒ­å–</span></div>
        <div class="product-price">RM33</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="è¾£å‘³è™¾è‚ ">-</button>
          <input type="number" class="quantity-input" id="è¾£å‘³è™¾è‚ " value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="è¾£å‘³è™¾è‚ ">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3873.jpeg" class="product-image" alt="åŸå‘³è™¾é¥¼" />
        </div>
        <div class="product-name">åŸå‘³è™¾é¥¼</div>
        <div class="product-price">RM28</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="åŸå‘³è™¾é¥¼">-</button>
          <input type="number" class="quantity-input" id="åŸå‘³è™¾é¥¼" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="åŸå‘³è™¾é¥¼">+</button>
        </div>
      </div>

      <!-- æŠ«è¨ç³»åˆ— -->
      <h2 class="category-title">ğŸ• æŠ«è¨ç³»åˆ—</h2>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3841.jpeg" class="product-image" alt="ç›æ ¼ä¸½ç‰¹æŠ«è¨" />
        </div>
        <div class="product-name">ç›æ ¼ä¸½ç‰¹æŠ«è¨</div>
        <div class="product-price">RM25</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="ç›æ ¼ä¸½ç‰¹æŠ«è¨">-</button>
          <input type="number" class="quantity-input" id="ç›æ ¼ä¸½ç‰¹æŠ«è¨" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="ç›æ ¼ä¸½ç‰¹æŠ«è¨">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3839.jpeg" class="product-image" alt="é»‘æ¤’ç‰›è‚‰æŠ«è¨" />
        </div>
        <div class="product-name">é»‘æ¤’ç‰›è‚‰æŠ«è¨</div>
        <div class="product-price">RM25</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="é»‘æ¤’ç‰›è‚‰æŠ«è¨">-</button>
          <input type="number" class="quantity-input" id="é»‘æ¤’ç‰›è‚‰æŠ«è¨" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="é»‘æ¤’ç‰›è‚‰æŠ«è¨">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3840.jpeg" class="product-image" alt="å¥¥å°”è‰¯é¸¡è‚‰æŠ«è¨" />
        </div>
        <div class="product-name">å¥¥å°”è‰¯é¸¡è‚‰æŠ«è¨</div>
        <div class="product-price">RM25</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="å¥¥å°”è‰¯é¸¡è‚‰æŠ«è¨">-</button>
          <input type="number" class="quantity-input" id="å¥¥å°”è‰¯é¸¡è‚‰æŠ«è¨" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="å¥¥å°”è‰¯é¸¡è‚‰æŠ«è¨">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3852.jpeg" class="product-image" alt="åŒæ–™æ¦´è²æŠ«è¨" />
        </div>
        <div class="product-name">åŒæ–™æ¦´è²æŠ«è¨ <span class="tag">ğŸŒŸ æ‹›ç‰Œ</span></div>
        <div class="product-price">RM40</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="åŒæ–™æ¦´è²æŠ«è¨">-</button>
          <input type="number" class="quantity-input" id="åŒæ–™æ¦´è²æŠ«è¨" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="åŒæ–™æ¦´è²æŠ«è¨">+</button>
        </div>
      </div>

      <!-- é…¥é¥¼ç³»åˆ— -->
      <h2 class="category-title">ğŸ¥® é…¥é¥¼ç³»åˆ—</h2>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3837.jpeg" class="product-image" alt="é»‘çŒªè‚‰é…¥é¥¼" />
        </div>
        <div class="product-name">é»‘çŒªè‚‰é…¥é¥¼</div>
        <div class="product-price">RM55</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="é»‘çŒªè‚‰é…¥é¥¼">-</button>
          <input type="number" class="quantity-input" id="é»‘çŒªè‚‰é…¥é¥¼" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="é»‘çŒªè‚‰é…¥é¥¼">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3838.jpeg" class="product-image" alt="å®‰æ ¼æ–¯ç‰›è‚‰é…¥é¥¼" />
        </div>
        <div class="product-name">å®‰æ ¼æ–¯ç‰›è‚‰é…¥é¥¼</div>
        <div class="product-price">RM55</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="å®‰æ ¼æ–¯ç‰›è‚‰é…¥é¥¼">-</button>
          <input type="number" class="quantity-input" id="å®‰æ ¼æ–¯ç‰›è‚‰é…¥é¥¼" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="å®‰æ ¼æ–¯ç‰›è‚‰é…¥é¥¼">+</button>
        </div>
      </div>

      <!-- å°ç¬¼æ±¤åŒ…ç³»åˆ— -->
      <h2 class="category-title">ğŸ¥Ÿ å°ç¬¼æ±¤åŒ…ç³»åˆ—</h2>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3874.jpeg" class="product-image" alt="é²œè‚‰å°ç¬¼æ±¤åŒ…" />
        </div>
        <div class="product-name">é²œè‚‰å°ç¬¼æ±¤åŒ…</div>
        <div class="product-price">RM12</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="é²œè‚‰å°ç¬¼æ±¤åŒ…">-</button>
          <input type="number" class="quantity-input" id="é²œè‚‰å°ç¬¼æ±¤åŒ…" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="é²œè‚‰å°ç¬¼æ±¤åŒ…">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3875.jpeg" class="product-image" alt="èŒè‡å°ç¬¼æ±¤åŒ…" />
        </div>
        <div class="product-name">èŒè‡å°ç¬¼æ±¤åŒ…</div>
        <div class="product-price">RM12</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="èŒè‡å°ç¬¼æ±¤åŒ…">-</button>
          <input type="number" class="quantity-input" id="èŒè‡å°ç¬¼æ±¤åŒ…" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="èŒè‡å°ç¬¼æ±¤åŒ…">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3876.jpeg" class="product-image" alt="é»‘æ¾éœ²å°ç¬¼æ±¤åŒ…" />
        </div>
        <div class="product-name">é»‘æ¾éœ²å°ç¬¼æ±¤åŒ… <span class="tag">ğŸ’ è±ªå</span></div>
        <div class="product-price">RM12</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="é»‘æ¾éœ²å°ç¬¼æ±¤åŒ…">-</button>
          <input type="number" class="quantity-input" id="é»‘æ¾éœ²å°ç¬¼æ±¤åŒ…" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="é»‘æ¾éœ²å°ç¬¼æ±¤åŒ…">+</button>
        </div>
      </div>

      <!-- é¸¡æ’ç³»åˆ— -->
      <h2 class="category-title">ğŸ— é¸¡æ’ç³»åˆ—</h2>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3835.jpeg" class="product-image" alt="åŸå‘³é¸¡æ’" />
        </div>
        <div class="product-name">åŸå‘³é¸¡æ’ <span class="tag">ğŸ† æ— æŠ—è®¤è¯</span></div>
        <div class="product-price">RM20</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="åŸå‘³é¸¡æ’">-</button>
          <input type="number" class="quantity-input" id="åŸå‘³é¸¡æ’" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="åŸå‘³é¸¡æ’">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3836.jpeg" class="product-image" alt="å¥¥å°”è‰¯é¸¡æ’" />
        </div>
        <div class="product-name">å¥¥å°”è‰¯é¸¡æ’</div>
        <div class="product-price">RM20</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="å¥¥å°”è‰¯é¸¡æ’">-</button>
          <input type="number" class="quantity-input" id="å¥¥å°”è‰¯é¸¡æ’" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="å¥¥å°”è‰¯é¸¡æ’">+</button>
        </div>
      </div>

      <!-- é¸¡ç¿…ç³»åˆ— -->
      <h2 class="category-title">ğŸ— é¸¡ç¿…ç³»åˆ—</h2>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3865.jpeg" class="product-image" alt="å¥¥å°”è‰¯é¸¡ç¿…" />
        </div>
        <div class="product-name">å¥¥å°”è‰¯é¸¡ç¿…</div>
        <div class="product-price">RM25</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="å¥¥å°”è‰¯é¸¡ç¿…">-</button>
          <input type="number" class="quantity-input" id="å¥¥å°”è‰¯é¸¡ç¿…" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="å¥¥å°”è‰¯é¸¡ç¿…">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3866.jpeg" class="product-image" alt="é’èŠ±æ¤’é¸¡ç¿…" />
        </div>
        <div class="product-name">é’èŠ±æ¤’é¸¡ç¿… <span class="tag">ğŸŒ¶ï¸ éº»è¾£</span></div>
        <div class="product-price">RM25</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="é’èŠ±æ¤’é¸¡ç¿…">-</button>
          <input type="number" class="quantity-input" id="é’èŠ±æ¤’é¸¡ç¿…" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="é’èŠ±æ¤’é¸¡ç¿…">+</button>
        </div>
      </div>

      <!-- çº¸çš®çƒ§å–ç³»åˆ— -->
      <h2 class="category-title">ğŸ¥Ÿ çº¸çš®çƒ§å–ç³»åˆ—</h2>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3843.jpeg" class="product-image" alt="é»‘çŒªä¸‰ä¸çº¸çš®çƒ§å–" />
        </div>
        <div class="product-name">é»‘çŒªä¸‰ä¸çº¸çš®çƒ§å–</div>
        <div class="product-price">RM15</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="é»‘çŒªä¸‰ä¸çº¸çš®çƒ§å–">-</button>
          <input type="number" class="quantity-input" id="é»‘çŒªä¸‰ä¸çº¸çš®çƒ§å–" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="é»‘çŒªä¸‰ä¸çº¸çš®çƒ§å–">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3842.jpeg" class="product-image" alt="é»‘æ¤’ç‰›è‚‰çº¸çš®çƒ§å–" />
        </div>
        <div class="product-name">é»‘æ¤’ç‰›è‚‰çº¸çš®çƒ§å–</div>
        <div class="product-price">RM15</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="é»‘æ¤’ç‰›è‚‰çº¸çš®çƒ§å–">-</button>
          <input type="number" class="quantity-input" id="é»‘æ¤’ç‰›è‚‰çº¸çš®çƒ§å–" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="é»‘æ¤’ç‰›è‚‰çº¸çš®çƒ§å–">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3844.jpeg" class="product-image" alt="é»‘çŒªæ¢…èœå¹²çº¸çš®çƒ§å–" />
        </div>
        <div class="product-name">é»‘çŒªæ¢…èœå¹²çº¸çš®çƒ§å–</div>
        <div class="product-price">RM15</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="é»‘çŒªæ¢…èœå¹²çº¸çš®çƒ§å–">-</button>
          <input type="number" class="quantity-input" id="é»‘çŒªæ¢…èœå¹²çº¸çš®çƒ§å–" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="é»‘çŒªæ¢…èœå¹²çº¸çš®çƒ§å–">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3845.jpeg" class="product-image" alt="ä¸‰ä¸èŠå£«çº¸çš®çƒ§å–" />
        </div>
        <div class="product-name">ä¸‰ä¸èŠå£«çº¸çš®çƒ§å– <span class="tag">ğŸ§€ æ‹‰ä¸</span></div>
        <div class="product-price">RM15</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="ä¸‰ä¸èŠå£«çº¸çš®çƒ§å–">-</button>
          <input type="number" class="quantity-input" id="ä¸‰ä¸èŠå£«çº¸çš®çƒ§å–" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="ä¸‰ä¸èŠå£«çº¸çš®çƒ§å–">+</button>
        </div>
      </div>

      <div class="product">
        <div class="product-image-container">
          <img src="IMG_3846.jpeg" class="product-image" alt="ä¹Œç±³è…Šå‘³çº¸çš®çƒ§å–" />
        </div>
        <div class="product-name">ä¹Œç±³è…Šå‘³çº¸çš®çƒ§å–</div>
        <div class="product-price">RM15</div>
        <div class="quantity-control">
          <button type="button" class="quantity-btn minus" data-product="ä¹Œç±³è…Šå‘³çº¸çš®çƒ§å–">-</button>
          <input type="number" class="quantity-input" id="ä¹Œç±³è…Šå‘³çº¸çš®çƒ§å–" value="0" min="0" />
          <button type="button" class="quantity-btn plus" data-product="ä¹Œç±³è…Šå‘³çº¸çš®çƒ§å–">+</button>
        </div>
      </div>

      <!-- æ€»ä»· -->
      <div class="total">å…±è®¡ï¼šRM<span id="totalAmount">0.00</span></div>

      <!-- å¤‡æ³¨æ  -->
      <div class="form-group">
        <label for="remarks">ğŸ“ å¤‡æ³¨</label>
        <textarea id="remarks" placeholder="å¡«å†™å…¶ä»–è¯´æ˜ï¼ˆé€‰å¡«ï¼‰"></textarea>
      </div>

      <!-- é“¶è¡Œè½¬è´¦è¯´æ˜ -->
      <div class="form-group">
        <label>ğŸ’³ è½¬è´¦è‡³ä»¥ä¸‹è´¦æˆ·ï¼š</label>
        <p style="margin:4px 0;">é“¶è¡Œï¼š<strong>Maybank</strong></p>
        <p style="margin:4px 0;">æˆ·å£åï¼š<strong>Choong Sher Lee</strong></p>
        <p style="margin:4px 0;">æˆ·å£å·ç ï¼š<strong>114209540438</strong></p>
        <div style="display:flex; gap:10px; margin-top:10px;">
          <img src="IMG_4042.png" alt="æ”¶æ¬¾ç 1" style="width:48%;border-radius:8px;" />
          <img src="IMG_4043.jpeg" alt="æ”¶æ¬¾ç 2" style="width:48%;border-radius:8px;" />
        </div>
      </div>

      <!-- ä¸Šä¼ è½¬è´¦å‡­è¯ -->
      <div class="file-upload">
        <label for="payment">ğŸ“ ä¸Šä¼ è½¬è´¦å‡­è¯ *</label>
        <input type="file" id="payment" name="payment" accept="image/*,.pdf" required />
        <div id="paymentError" class="error-message"></div>
      </div>

      <button type="submit" class="submit-btn">ğŸš€ æäº¤è®¢å•</button>

      <!-- è®¢å•ç¡®è®¤å¼¹çª— -->
      <div id="confirmationDialog" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:999;justify-content:center;align-items:center;">
        <div id="confirmationContent" style="background:white;padding:20px;border-radius:10px;max-width:500px;width:90%;max-height:80vh;overflow:auto;"></div>
      </div>

    </form>

    <!-- ç®¡ç†å‘˜å¯¼å‡ºåŒºåŸŸ -->
    <div style="margin-top:30px;">
      <button id="showExportBtn" class="submit-btn" style="background:#57606f;">ğŸ“¤ å¯¼å‡ºè®¢å• (ç®¡ç†å‘˜)</button>
      <div id="adminPanel" style="display:none;margin-top:10px;">
        <input type="password" id="adminPassword" placeholder="è¾“å…¥ç®¡ç†å‘˜å¯†ç " class="form-group" />
        <button id="realExportBtn" class="submit-btn" style="background:#2f3542;">ğŸ”’ ç¡®è®¤å¯¼å‡º Excel</button>
      </div>
    </div>
  </div>

<!-- è„šæœ¬åŠŸèƒ½åŒº -->
<script>
const SUPABASE_URL = 'https://edfnhhthztskuuosuasw.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...KoAo';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

function formatPhone(phone) {
  const digits = phone.replace(/\D/g, '');
  if (digits.startsWith('60')) return digits;
  if (digits.startsWith('0')) return '60' + digits.slice(1);
  return '60' + digits;
}

function calculateTotal() {
  let total = 0;
  document.querySelectorAll('.quantity-input').forEach(input => {
    const qty = parseInt(input.value) || 0;
    if (qty > 0) {
      const price = parseFloat(input.closest('.product').querySelector('.product-price').textContent.replace('RM',''));
      total += qty * price;
    }
  });
  document.getElementById('totalAmount').textContent = total.toFixed(2);
  return total;
}

function validateForm() {
  let valid = true;
  const name = document.getElementById('name');
  const phone = document.getElementById('phone');
  const delivery = document.getElementById('delivery');
  const remarks = document.getElementById('remarks');
  const payment = document.getElementById('payment');
  const agree = document.getElementById('agreeCheckbox');

  document.querySelectorAll('.error-message').forEach(e => e.style.display = 'none');
  document.querySelectorAll('input, select, textarea').forEach(el => el.classList.remove('input-error'));

  if (!name.value.trim()) {
    name.classList.add('input-error');
    document.getElementById('nameError').textContent = 'è¯·è¾“å…¥å§“å';
    document.getElementById('nameError').style.display = 'block';
    valid = false;
  }

  if (!phone.value.trim()) {
    phone.classList.add('input-error');
    document.getElementById('phoneError').textContent = 'è¯·è¾“å…¥ç”µè¯';
    document.getElementById('phoneError').style.display = 'block';
    valid = false;
  }

  if (!delivery.value) {
    delivery.classList.add('input-error');
    document.getElementById('deliveryError').textContent = 'è¯·é€‰æ‹©å–è´§æ–¹å¼';
    document.getElementById('deliveryError').style.display = 'block';
    valid = false;
  }

  if (!agree.checked) {
    alert('è¯·å‹¾é€‰åŒæ„æ¡æ¬¾');
    valid = false;
  }

  if (!payment.files.length) {
    payment.classList.add('input-error');
    document.getElementById('paymentError').textContent = 'è¯·ä¸Šä¼ è½¬è´¦å‡­è¯';
    document.getElementById('paymentError').style.display = 'block';
    valid = false;
  }

  const hasProduct = [...document.querySelectorAll('.quantity-input')].some(input => parseInt(input.value) > 0);
  if (!hasProduct) {
    alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä»¶å•†å“');
    valid = false;
  }

  return valid;
}

function buildWhatsAppMessage(order) {
  const phoneLink = formatPhone(order.phone);
  let msg = `*ğŸ›ï¸ [æ–°è®¢å•] é”‹å‘³æ´¾è®¢å• #${order.orderId}*%0A%0A`;
  msg += `ğŸ‘¤ å§“å: ${order.name}%0AğŸ“± ç”µè¯: https://wa.me/${phoneLink}%0AğŸšš å–è´§æ–¹å¼: ${order.delivery === 'self-pickup' ? 'è‡ªå–' : 'Lalamoveé€è´§'}%0A%0A`;
  msg += `ğŸ›’ è®¢å•å†…å®¹:%0A`;
  order.items.forEach(i => {
    msg += `â–«ï¸ ${i.product} Ã— ${i.quantity} = RM${(i.price * i.quantity).toFixed(2)}%0A`;
  });
  msg += `%0AğŸ’° æ€»é‡‘é¢: RM${order.total.toFixed(2)}%0A`;
  msg += `ğŸ“ å¤‡æ³¨: ${order.remarks || 'ï¼ˆæ— ï¼‰'}%0A`;
  msg += `ğŸ“… æ—¶é—´: ${new Date().toLocaleString('zh-CN')}`;
  return msg;
}

async function submitOrder(order) {
  document.getElementById('loadingOverlay').style.display = 'flex';
  try {
    const proofFile = document.getElementById('payment').files[0];
    let proofUrl = '';
    if (proofFile) {
      const ext = proofFile.name.split('.').pop();
      const filename = `${Date.now()}_${Math.random().toString(36).slice(2)}.${ext}`;
      const { error: uploadErr } = await supabase.storage.from('payment-proofs').upload(`proofs/${filename}`, proofFile);
      if (uploadErr) throw uploadErr;
      const { data } = supabase.storage.from('payment-proofs').getPublicUrl(`proofs/${filename}`);
      proofUrl = data.publicUrl;
    }

    await supabase.from('orders').insert([{
      order_id: order.orderId,
      name: order.name,
      phone: order.phone,
      delivery_method: order.delivery,
      remarks: order.remarks,
      total_amount: order.total,
      order_items: order.items,
      payment_proof_url: proofUrl,
      status: 'pending',
      created_at: new Date().toISOString()
    }]);

    alert('âœ… è®¢å•å·²æäº¤ï¼Œæ­£åœ¨è·³è½¬ WhatsApp...');
  } catch (err) {
    alert('âŒ è®¢å•æäº¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
    console.error(err);
  } finally {
    document.getElementById('loadingOverlay').style.display = 'none';
  }
}

function showConfirmation(order) {
  const preview = decodeURIComponent(buildWhatsAppMessage(order)).replace(/%0A/g, '\n');

  let html = `<h2 style="text-align:center;color:#FF4757;">ç¡®è®¤è®¢å•</h2>`;
  html += `<p><strong>å§“å:</strong> ${order.name}</p>`;
  html += `<p><strong>ç”µè¯:</strong> ${order.phone}</p>`;
  html += `<p><strong>å–è´§æ–¹å¼:</strong> ${order.delivery === 'self-pickup' ? 'è‡ªå–' : 'Lalamoveé€è´§'}</p>`;
  html += `<h3>è®¢å•æ˜ç»†</h3>`;
  order.items.forEach(i => {
    html += `<p>${i.product} Ã— ${i.quantity} = RM${(i.price * i.quantity).toFixed(2)}</p>`;
  });
  html += `<p><strong>æ€»é‡‘é¢:</strong> RM${order.total.toFixed(2)}</p>`;
  html += `<p><strong>å¤‡æ³¨:</strong> ${order.remarks || 'ï¼ˆæ— ï¼‰'}</p>`;
  html += `<h3>ğŸ“¤ WhatsApp é¢„è§ˆ</h3><textarea style="width:100%;height:120px">${preview}</textarea>`;
  html += `<div style="display:flex; justify-content:space-between; margin-top:20px;">
    <button id="confirmCancel" class="submit-btn" style="background:gray;">å–æ¶ˆ</button>
    <button id="confirmSend" class="submit-btn">ç¡®è®¤å¹¶å‘é€</button></div>`;

  const dialog = document.getElementById('confirmationDialog');
  document.getElementById('confirmationContent').innerHTML = html;
  dialog.style.display = 'flex';

  document.getElementById('confirmCancel').onclick = () => dialog.style.display = 'none';

  document.getElementById('confirmSend').onclick = () => {
    dialog.style.display = 'none';
    const waUrl = `https://wa.me/${formatPhone('0162327792')}?text=${buildWhatsAppMessage(order)}`;
    const link = document.createElement('a');
    link.href = waUrl;
    link.target = '_blank';
    link.rel = 'noopener noreferrer';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    submitOrder(order);
  };
}

document.addEventListener('DOMContentLoaded', () => {
  calculateTotal();

  document.querySelectorAll('.quantity-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const input = document.getElementById(btn.dataset.product);
      let val = parseInt(input.value) || 0;
      input.value = btn.classList.contains('plus') ? val + 1 : Math.max(0, val - 1);
      calculateTotal();
    });
  });

  document.querySelectorAll('.quantity-input').forEach(input => {
    input.addEventListener('change', () => {
      input.value = Math.max(0, parseInt(input.value) || 0);
      calculateTotal();
    });
  });

  document.getElementById('orderForm').addEventListener('submit', e => {
    e.preventDefault();
    if (!validateForm()) return;

    const orderId = `ORD-${Date.now()}`;
    const order = {
      orderId,
      name: document.getElementById('name').value.trim(),
      phone: document.getElementById('phone').value.trim(),
      delivery: document.getElementById('delivery').value,
      remarks: document.getElementById('remarks').value.trim(),
      items: [],
      total: calculateTotal()
    };

    document.querySelectorAll('.quantity-input').forEach(input => {
      const qty = parseInt(input.value) || 0;
      if (qty > 0) {
        const product = input.closest('.product');
        const name = product.querySelector('.product-name').textContent.trim().split(' ')[0];
        const price = parseFloat(product.querySelector('.product-price').textContent.replace('RM',''));
        order.items.push({ product: name, quantity: qty, price });
      }
    });

    showConfirmation(order);
  });

  document.getElementById('showExportBtn').onclick = () => {
    document.getElementById('adminPanel').style.display = 'block';
  };

  document.getElementById('realExportBtn').onclick = async () => {
    const pwd = document.getElementById('adminPassword').value;
    if (pwd !== 'fengweipai2024') {
      alert('å¯†ç é”™è¯¯');
      return;
    }

    const { data, error } = await supabase.from('orders').select('*');
    if (error) return alert('å¯¼å‡ºå¤±è´¥');

    const rows = data.map(o => ({
      è®¢å•ç¼–å·: o.order_id,
      å§“å: o.name,
      ç”µè¯: o.phone,
      æ–¹å¼: o.delivery_method,
      å•†å“: o.order_items.map(i => `${i.product}Ã—${i.quantity}`).join(', '),
      æ€»é¢: o.total_amount,
      å¤‡æ³¨: o.remarks || '',
      å‡­è¯é“¾æ¥: o.payment_proof_url,
      æ—¶é—´: o.created_at
    }));

    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.json_to_sheet(rows);
    XLSX.utils.book_append_sheet(wb, ws, 'è®¢å•');
    XLSX.writeFile(wb, `è®¢å•å¯¼å‡º_${new Date().toLocaleDateString()}.xlsx`);
  };
});
</script>
</body>
</html>